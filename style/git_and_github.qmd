---
editor:
  markdown:
    wrap: sentence
---

# Using Git and GitHub

::: {.callout-important appearance="default" icon="true"}
**Never** push to the `main` branch!
Code must always be reviewed first.
:::

## Workflow with Git and GitHub


### Create an issue

If you haven't already, file an issue that describes what you are doing - whether it be fixing a bug, adding a feature, or something else.
Issues help to keep track of both the work to be done, and the work that has been done.

You should ensure that the issue is as detailed as possible as it may need to be picked up by someone else.
Even if only you intend to work on the issue, over time it can be easy to forget things if there isn't enough information.
They can also help you to remember what changes you have made to your code, and why you had to make these changes, which can be useful if you need to provide change logs when you release your code.
You could even attach screenshots or other images that help explain the problem and anything you've tried in the past that hasn't worked out.
If you can, try to provide a reproducible example ('reprex'), perhaps by using [the {reprex} R package](https://reprex.tidyverse.org/).

::: aside
Issues are a good record to explain what a PR is for.
It's also a useful area for input from other members of the team.
:::

### Obtain the code

To contribute to someone else's code, you will first need to clone a copy of their repository onto your computer.
You can do this by first obtaining the URL of the repository of interest, by clicking the green 'Code' button on the top right of the repository home page.

![](Code_button.jpg){fig-alt="Screenshot of GitHub with the green repository code button circled in red."}

Using the command line, Git Bash, the RStudio terminal or another shell script program,
navigate to the location you'd like the files stored in, then run:

```
git clone https://github.com/<user or org name>/<repository name>.git
```

You can then use file explorer (if on Windows) to navigate to the R project folder
within the files you've cloned, and open it to begin working with the code.

### Create a branch

Once the issue is created and you have decided that you are going to work on it, first assign yourself to the issue in GitHub.
This is an indication to others and helps to prevent multiple people from independently working on the same issue.

Once you have assigned yourself, you must make a new branch to work on that feature.
GitHub offers a button to do this automatically on the issue page, on the right-hand side.

[![Screenshot links to specific GitHub help page](branch_img.png){fig-alt="Screenshot of GitHub with the hyperlink to Create a branch highlighted under the category of Development."}](https://docs.github.com/en/issues/tracking-your-work-with-issues/creating-a-branch-for-an-issue)

::: aside
If you used the `create branch` button on GitHub it will automatically close the issue when merged.
:::

Locally you can then work on the branch, pushing your code regularly to GitHub so it can be run and inspected when you are not around.

#### Write commits

All commits should be [atomic](https://dev.to/samuelfaure/how-atomic-git-commits-dramatically-increased-my-productivity-and-will-increase-yours-too-4a84), in short,

> Each commit does one, and only one simple thing, that can be summed up in a simple sentence.

All of your commits should be in branches, the only changes that are made to the `main` branch would be via pull requests (PR) that have been reviewed by at minimum one colleague.

When you think that your changes are ready to be merged, it's time to create a PR and request a code review.

## Creating and reviewing PRs

When you create a PR, you must do two things:

1.  Immediately make someone an assignee - this is the person who will merge the PR. Typically, this should be the person creating the PR (you)
2.  Select a person (or people) to review the PR (if the repository is open and has a CODEOWNERS file, then the users named in that file will be automatically assigned as reviewers)

If your code is not yet ready to be merged then you should use a draft PR.

::: aside
Note that draft PRs are only available on public GitHub repos.
:::

Wait until the reviewer(s) has completed the review and marked it as ready to merge.
At this point, the person who is assigned to the PR can complete the merge.

::: aside
Most merges will be the default `Create a merge commit` but sometimes you may wish to `Squash and merge`.
As the person requesting the PR, you can select whichever option is wanted from the drop-down in GitHub as part of the PR.
:::

### Reviewing methodology

By using this approach of the assignee completing the merge, it ensures that code quality is maintained and prevents code from being merged when it is not yet ready.
For example, you may have started a PR thinking your work is complete, and a reviewer checks the code and agrees to merge, however, you may realise that there are still things to work on, or there are issues that need to be addressed.

The person who is assigned to the PR should be the only person making commits to the branch and this will prevent merge conflicts.
If you wish for someone else to collaborate on the branch, then you should assign the PR to that person.
At that point, they can pull your branch down and work on it, but you must stop using that branch locally.

::: {.callout-important appearance="default" icon="true"}
Only one person should ever work on changes to a branch at any time, and it is important to communicate with colleagues so they know to pull the latest changes in.
:::

::: aside
If the PR is later assigned back to you then you must immediately pull changes.
:::

There may be times when you cannot be the assignee on a PR and in those situations you should nominate someone else to be the assignee and in charge of the PR, the same rules as in the paragraph above would then apply.

If, as a reviewer, you find that no one is assigned to the branch, you should get in contact with the person who created the branch and decide who is going to be the assigned owner of the PR.

#### Outside collaborators

In circumstances where the person who created the PR is an outside collaborator and doesn't have permission to merge, then the reviewer should also be the assignee.
In these circumstances, the collaborator will be working from their local fork and will be the only person who can push to the branch.
The reviewer, once happy to approve the changes, can merge the PR.

## Preparing a package release of your code

We use [semantic versioning](https://semver.org/).

## Repository organisation

Each of the team's repositories should have two assigned roles: owner and deputy.

The owner is likely to be the person who created the repository and/or has good knowledge of its content.
The responsibility of the owner is to:

-   have overall responsibility for quality
-   triage issues, label them (especially 'bug' and 'must') and put into milestones
-   tag and release the code and, if relevant, deploy it
-   bring important issues to sprint by adding to backlog
-   define how PRs are reviewed (e.g. issue/PR templates, CI Actions) and that they are reviewed
-   ensure adequate testing is in place
-   add and maintain the [CODEOWNERS file](https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/customizing-your-repository/about-code-owners)

The deputy should perform these duties in the absence of the owner and provide updates to the owner on their return.

### Template repository

The Data Science team at The Strategy Unit maintain [a template repository](https://github.com/The-Strategy-Unit/template-repository) that contains the minimum set of files and basic structure needed to ensure organisational consistency in repository management. You are welcome to view, clone, copy or reuse the template as you see fit.

## Make your repo useful for others

### Motivation

In the spirit of [our open source policy](https://connect.strategyunitwm.nhs.uk/open-source-policy/), we should make it easy for others to reuse, repurpose or contribute to our code.
Given our desire to improve transparency and help educate others, our content should be findable and the content understood easily.
Visitors to our repos should be able to find what they're looking for and maybe discover something new.

This sentiment is true for private as well as public repositories.
Thoughtful repo construction and documentation are a courtesy to your colleagues.
It's also good practice because we should aim for all repos to be open eventually, if not immediately.

### User stories

You should consider who your users might be and what their user stories might be.
For example, as:

* an internal developer I want to reuse some code so that I can ensure consistency with our existing approaches
* an external developer I want to understand the contribution process for a repo so that I can submit a bug fix
* an external manager I want to look at The Strategy Unit's repos so that I can understand best practice for presenting and disseminating code
* a member of the public I want to inspect the code and methods used by the team so that I can understand how taxpayer money is being used

### Practical tips

Below are some non-exhaustive ideas for how you can improve the usefulness and usability of your repo to others.
This is non-exhaustive set of suggestions and you will need to make your own decisions depending on the nature of the repo.

To improve organisation and findability:

* use a succinct but explanatory name for your repo (you can [change it](https://docs.github.com/en/repositories/creating-and-managing-repositories/renaming-a-repository))
* add some [GitHub topics](https://github.com/topics) to group-up repos and make them more searchable (see [the topics on our NHP repos](https://github.com/The-Strategy-Unit/nhp_products/wiki/List-of-all-NHP-repos), for example)
* consider [custom properties](https://docs.github.com/en/enterprise-cloud@latest/organizations/managing-organization-settings/managing-custom-properties-for-repositories-in-your-organization)

To explain your code's purpose:

* complete the description in the repo's 'about' section
* make sure to include a `README` file with a short description near the top, which can provide quick context and link to related information or projects

So people can understand the state of your project:

* use `README` badges to indicate statuses like passing checks, [project lifecycle stage](https://www.repostatus.org/) and publication to package indexes (e.g. PyPi, CRAN)
* [tag and release](https://docs.github.com/en/repositories/releasing-projects-on-github/managing-releases-in-a-repository) your code using [semantic versioning](https://semver.org/) and add clear notes of the changes made
* keep a human-readable changelog up-to-date (e.g. [a NEWS.md file](https://r-pkgs.org/other-markdown.html#sec-news) in an R package)

To make it easy for people to (re)use your code (and products):

* make sure your `README` file explains any prerequisites (e.g. dependencies, data, environment variables) and outlines the method to run the code
* use good coding practice like clear variable naming, modularisation into functions/classes/sub-scripts and judicious use of explanatory comments
* consider [a repo Wiki](https://docs.github.com/en/communities/documenting-your-project-with-wikis/about-wikis) to provide supporting info
* consider organising your code into its most reusable or shareable form (e.g. an R package)
* ensure you have a `LICENSE` so people know how they can (re)use your code

To allow people to contribute:

* make clear the repo's owner and deputy with a [CODEOWNERS file](https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/customizing-your-repository/about-code-owners) and possibly include owners for specific directories and files
* state preferred methods of contact in the `README` (e.g. via issues or perhaps [GitHub Discussions](https://github.com/features/discussions) for community building)
* add instructions in [a `CONTRIBUTING.md` file](https://docs.github.com/en/communities/setting-up-your-project-for-healthy-contributions/setting-guidelines-for-repository-contributors)
* use [issue templates](https://docs.github.com/en/communities/using-templates-to-encourage-useful-issues-and-pull-requests/configuring-issue-templates-for-your-repository) to help users ask for or report things
* use common [issue labels](https://docs.github.com/en/issues/using-labels-and-milestones-to-track-work/managing-labels) to highlight issue complexity/priority
* consider a [CODE_OF_CONDUCT.md](https://docs.github.com/en/communities/setting-up-your-project-for-healthy-contributions/adding-a-code-of-conduct-to-your-project) document

So other developers know how to dev with you:

* Use [rulesets](https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/managing-rulesets/about-rulesets) to protect your main branch
* make pull requests early, [marked as draft](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/changing-the-stage-of-a-pull-request) with an assignee so 'in-progress' work is visible
* make clear the preferred Git branching strategy (e.g. feature branches off of main)

To make it easier for developers to get an at-a-glance understanding:

* follow conventions and good-practice for the language being used, e.g. R and Python packages
* use a simple, self-explanatory directory structure (e.g. images in `img/`, data in `data/`)
* start with [the SU template repository](https://github.com/The-Strategy-Unit/template-repository) (click 'use this template' button or '+ create new' > 'new repository' > 'start with template')

## Further reading

See also our [GitHub as a Team Sport](../presentations/2024-05-23_github-team-sport/index.qmd) presentation for ideas about working together in GitHub repos.
