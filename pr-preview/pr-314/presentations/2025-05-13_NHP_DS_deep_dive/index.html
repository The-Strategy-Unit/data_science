<!DOCTYPE html>
<html lang="en"><head>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-de070a7b0ab54f8780927367ac907214.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.30">

  <meta name="author" content="Claire Welsh">
  <meta name="dcterms.date" content="2025-05-07">
  <title>Data Science @ The Strategy Unit – NHP Demand and Capacity (D&amp;C) Model</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
  </style>
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/theme/quarto-09c34abcecefe638f33e6d3c2293a836.css">
  <link href="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">NHP Demand and Capacity (D&amp;C) Model</h1>
  <p class="subtitle">A Technical Deep Dive for Data Scientists</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
<a href="mailto:claire.welsh8@nhs.net" target="_blank">Claire Welsh</a> 
</div>
</div>
</div>

  <p class="date">7 May 2025</p>
</section>
<section id="the-new-hospital-programme-nhp-demand-model" class="slide level2">
<h2>The New Hospital Programme (NHP) Demand Model</h2>

<img data-src="Model process.png" alt="Diagram showing the processes of the model" class="r-stretch quarto-figure-center"><p class="caption">Diagram of model process</p><aside class="notes">
<p>A quick reminder of how the model works.</p>
<p>This is an updated image of the modelling process, showing the elements currently supported.</p>
<p>The NHP Demand model is A probabilistic Monte Carlo simulation that:</p>
<ol type="1">
<li><p>Takes hospital activity from a baseline year, using NHS England’s Hospital Episode Statistics (HES) data</p></li>
<li><p>Applies variables that:</p>
<ul>
<li>are outside of our control (e.g.&nbsp;population changes, using ONS projections),
<ul>
<li>A choice of projections</li>
<li>Non-demographic growth estimates Nationally, both of which will swell the baseline</li>
</ul></li>
<li>Then we apply elements that can reduce hospital activity (mitigators, e.g.&nbsp;virtual wards or teleappointments). So these components, given to us from your inputting your P10 and P90 confidence limits, can either remove some future activity, modify it or reduce length of stay.</li>
</ul></li>
<li><p>Forecasts future demand based on these variables, outputting probabilistic predictive intervals.</p>
<p>The data needed include HES baseline, ONS populations, national NDG, COVID adjustement (no longer for 23/24), HSA, reference lookups.</p>
<p>We need the model to be able to preserve selections, results, version control the data and model Needs to be fast and reactive to user inputs.</p>
<p>Added difficulties are that</p></li>
<li><p>Hospitals are actively using the model while it is still in development, which can be tricky</p></li>
<li><p>Dataset is massive for each hospital - hundreds and thousands of rows - all activity for a hospital trust in one year</p></li>
<li><p>Model can accommodate hundreds of different variables, and more are added over time.</p></li>
<li><p>We need the model to be backwards compatible, so that we can rerun any historic runs.</p>
</li></ol><style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>

</section>
<section id="section" class="slide level2">
<h2></h2>

<img data-src="NHP_diagram_public_v3-2.png" class="quarto-figure quarto-figure-center r-stretch" style="width:20in" alt="Diagram showing the model infrastructure layout"><aside class="notes">
<ul>
<li>Here’s an overview of the setup for the infrastructure.</li>
<li>This is quite an old diagram, there are more code repositories now, but the basics are the same Will explain more of some elements in a minute</li>
</ul>
<ol type="1">
<li>We start with the HES data, which is processed using Databricks and stored on Azure, accessed with PySpark. The ONS data also lives here, and both are combined and wrangled by the python code in the nhp_data repo to produce the model-ready data version which lives in Azure.</li>
<li>The inputs data is pulled in to the inputs app, which lives on Posit Connect and which you should all be familiar with. This enables users to see historic trends for mitigator activity in their scheme, look at summary counts etc.</li>
<li>Every time to move a slider or make a selecion on the inputs app, those data are captured by a reactive JSON file that preserves all the metadata for your model run. This is also kept on Connect.</li>
<li>When you click Run, the JSON is sent via the API to the model, whose code lives in the nhp_model repo and is written in python.</li>
</ol>
<ul>
<li>The model spins up a new Docker image on the Azure Container Registry in which to run the model as I described previously.</li>
<li>The output is the results parquet file, which is saved onto the Azure storage.</li>
<li>Finally, the outputs app, also on Connect, picks up this results file and uses it to display all the charts and summaries you’re used to, as well as allowing you to download the results.</li>
</ul>
All these datasets, the inputs, results and JSON files are preserved for the future.
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section-1" class="slide level2">
<h2></h2>

<img data-src="architecture-mermaid-transparent.png" alt="A diagram showing the architecture of the model and apps. Data is processed from the database by the targets package and stored in an Azure storage account. the model and inputs and outputs apps collected data from there. Selections in the inputs app feed into the model." class="r-stretch"><aside class="notes">
<p>Here’s a simplified, zoomed-in version.</p>
<p>HES data from the database is used to make the inputs data, which is pulled in to the inputs app.</p>
<p>That sends information to the model, which creates results that are sent back to storage, and from which the ourputs app does its thing.</p>
By why did we choose this setup? It seems complicated and busy.
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="principles" class="slide level2">
<h2>Principles</h2>
<ul>
<li>Deploy alongside develop</li>
<li>Reproducible analytical pipelines</li>
<li>Transparent</li>
<li>Open (FOSS where possible)</li>
<li>Team skills and work management</li>
</ul>
<aside class="notes">
<ul>
<li><p>Some of these choices stem from original familiarity of staff with those languages, for example, or from institutional restrictions</p></li>
<li><p>But as a general rule, we will choose the best tool for the job, being open to upskilling across the board and sharing our learning.</p></li>
<li><p>We operate in a fast-paced environment where the model is in active use Nationally and we must maintain that status while developing new functionality to provide a seamless improvement arc for users</p></li>
<li><p>We operate based on the principles of RAP and have opened the code base</p></li>
<li><p>Which improves transparency for users, developers and the public, since its all paid for with public funds.</p></li>
<li><p>Free and open source software is always used where we can, and we try to keep up with the latest advances</p></li>
<li><p>The happiness, satisfaction and development of our team is the cornerstone of everything</p></li>
<li><p>We foster a culture of continuous learning, sharing, openness and lack of blame.</p>
</li></ul><style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>

</section>
<section id="tools-and-platforms" class="slide level2">
<h2>Tools and platforms</h2>
<ul>
<li>Data pipelines: <i class="fa-brands fa-python" aria-label="python"></i>, parquet, CSV</li>
<li>Model: Python <i class="fa-brands fa-python" aria-label="python"></i>, Docker <i class="fa-brands fa-docker" aria-label="docker"></i></li>
<li>Apps: {shiny} and {golem} <i class="fa-brands fa-r-project" aria-label="r-project"></i>, Posit Connect <i class="fa-solid fa-layer-group" aria-label="layer-group"></i></li>
<li>Infrastructure and storage: Azure <i class="fa-brands fa-microsoft" aria-label="microsoft"></i></li>
<li>Documentation: Quarto <i class="fa-solid fa-feather" aria-label="feather"></i></li>
<li>Version control and collaboration: Git <i class="fa-brands fa-git-alt" aria-label="git-alt"></i>, GitHub <i class="fa-brands fa-github" aria-label="github"></i></li>
</ul>
<aside class="notes">
<ul>
<li><p>Our data pipelines leverage the speed of pyspark and Databricks.</p></li>
<li><p>The model is built in Python and involves a lot of <em>pandas</em> DataFrame manipulations.</p></li>
<li><p>We use Azure for storage of model input data and JSON files of parameters and parquet for results.</p></li>
<li><p>Users input model paramters in one Shiny app and view results in another. This uses modules and {golem} for its package focus, as well as {bs4Dash}. We have development and production environments.</p></li>
<li><p>We have a deployed Quarto website that contains the documentation for the whole project.</p>
</li></ul><style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>

</section>
<section id="data-for-nhp" class="slide level2">
<h2>Data for NHP</h2>
<div class="columns">
<div class="column" style="width:70%;">
<ul>
<li>HES data stored on Azure</li>
<li>Databricks and PySpark</li>
<li>CSVs and TSVs for reference data</li>
<li>parameters derived and stored in JSON</li>
</ul>
<p><img data-src="Apache_Parquet_logo.svg.png"></p>
</div><div class="column" style="width:30%;">
<p><img data-src="json.png"></p>
</div></div>
<aside class="notes">
<p>We use a Data lake on Azure using Databricks and parquet files. Apache Parquet = columnar data file format that is super fast and efficient Free and open source, contains metadata.</p>
<p>Its also just as simple to wrangle as CSVs or other more familiar filetypes so swapping from, for example Rds files to parquet, as we did when the files started getting too large, was easy.</p>
We used store results data in JSON (JavaScript Object Notation) but they got too big so moved to parquet But we maintain the parameters files in JSON format, a snapshot of which you can see here. Its a nice readable dictionary-type file format that is great for handling lots of key:value pairs as we do here.
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="generating-inputs-data" class="slide level2">
<h2>Generating inputs data</h2>

<img data-src="databricks-flowchart.png" class="r-stretch"><aside class="notes">
<p>This is a diagram of the Databricks workflows used to create the inputs data (which is a subset of the model data).</p>
<ul>
<li>If an upstream step fails, all downstream ones will. We used to handle this with {targets} so we’d only rerun the parts we needed, but now in DataBricks and using Parquet, the process is so fast this is moot. Targets didn’t play nicely with pyspark which is why we changed over.
</li></ul><style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>

</section>
<section id="model-running" class="slide level2">
<h2>Model running</h2>
<p>Parameters JSON passed to model via API</p>
<ul>
<li>Docker image stored on Azure Container Registry</li>
<li>Runs in Azure Container Instance</li>
<li>Built-in paralellisation features of Python language</li>
</ul>
<p><img data-src="docker-logo-blue.png" style="width:4in"></p>
<p><img data-src="Microsoft_Azure_Logo.svg.png"></p>
<aside class="notes">
Docker is for safety - need to run compute on protected data Also for environment handling. Again, Docker is FOSS.
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="interfaces" class="slide level2">
<h2>Interfaces</h2>
<div class="columns">
<div class="column" style="width:70%;">
<p>Coded in R - <a href="https://shiny.posit.co/">Shiny</a> Open repos: <a href="https://github.com/The-Strategy-Unit/nhp_inputs">nhp_inputs</a> and <a href="https://github.com/The-Strategy-Unit/nhp_outputs">nhp_outputs</a></p>
<p>Modular design</p>
<ul>
<li>Each function is in its own .R</li>
<li>Each module is separate</li>
<li>UIs and servers are separate</li>
<li>Packaged using {golem} to use R CMD check(), devtools::document() etc</li>
</ul>
</div><div class="column" style="width:30%;">
<p><img data-src="Shiny_hex_logo.svg.png"></p>
</div></div>
<aside class="notes">
<ul>
<li><p>In theory we could take in all the user’s required model run settings via a big spreadsheet, but the number of variables needed doesn’t have to get too big before this becomes problematic. Using apps is a visually appealing way of gathering that info while forcing users to provide inputs in the formats needed by the model.</p></li>
<li><p>Shiny is better than any spreadsheet thanks to this input verification, and it empowers users to understand their own data and choices.</p></li>
<li><p>Our apps are coded in Shiny, because its a great tool for creating production-grade apps, and we have the in-house expertise to do so.</p></li>
<li><p>The repositories that contain the code for the apps are open so you can go on our GitHub and see it all.</p></li>
<li><p>We follow good practice convention on structure, where by each element of logic is kept in a separate .R file, and UI and server code are separate. This helps with debugging, human-readability and makes extending the functionality easier.</p></li>
<li><p>Golem is another R package that helps create Shiny apps as a package - meaning that we can leverage the benefits of CMD check and documentation to help QA our processes during the build.</p>
</li></ul><style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>

</section>
<section id="section-2" class="slide level2">
<h2></h2>
<img data-src="inputs.png">
<aside class="notes">
<ul>
<li><p>Taking the inputs app you’ll be familiar with as an example, here we see the landing page for the selection app. This app, stored on Connect, interacts with the Azure storage where those JSON parameters files are kept, so that it can pick up one of your previous models if you ask it to.</p></li>
<li><p>Once you’ve made those decisions, you are taken to the inputs app - which is actually a separate app hosted on Connect.</p>
</li></ul><style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>

</section>
<section id="section-3" class="slide level2">
<h2></h2>

<img data-src="inputs_selection.png" class="r-stretch"><aside class="notes">
<ul>
<li><p>Here is the front page of the inputs app that you will have interacted with if you managed to run a model yourself.</p></li>
<li><p>We have the metadata centrally, showing the choices you have made on the previous screen. These data are stored in the JSON file and be retrievable in future.</p></li>
<li><p>On the left you can see various modules like the baseline adjustment, and the COVID adjustment (no longer needed in the 23/24 baseline).</p></li>
<li><p>All parts of this app are coded in separate modules, two modules for each ‘part’.</p></li>
<li><p>Lets see how this looks in the code, stored on GitHub</p>
</li></ul><style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>

</section>
<section id="section-4" class="slide level2">
<h2></h2>

<img data-src="modular.png" class="r-stretch"><aside class="notes">
<ul>
<li><p>This is the open code repository for the inputs app on GitHub within the Strategy Unit organisation. We’ve clicked into the folder called simply ‘R’ here, as that’s conventionally where all the code logic that powers the functionality is held.</p></li>
<li><p>You can see that in this nhp_inputs repo, within the R folder, we have separate R files for each function (prefix “fct”) and two per module - one server and one UI, like for the baseline adjustment module.</p></li>
<li><p>This file structure should be familiar to those of you who have built or interacted with the bones of an R package, where the R folder is where the active code is stored in a modular format.</p></li>
</ul>
<p>** Open GitHub</p>
<ul>
<li><p>Because this app is built with {golem} the rest of the package structure is also followed, including having NAMESPACE, DESCRIPTION, LICENSE and README files, and separate folders for data, documentation and what to do on installation etc. As I said, because this app is structured like a package, and functions held in R files are documented with Roxygen skeletons etc, we can use the powerful package building tools like devtools::document() to ensure that any changes are picked up, giving a faster, smoother, cleaner build experience.</p></li>
<li><p>We also have some extras that are not mandatory, like a CODEOWNERS file, which I’ll come on to discuss later in this session.</p></li>
<li><p>The app can be run locally provided you give it the keys needed to access the data storage, which can be held in an Renviron file. Being able to run the app locally assists with debugging and development tasks.</p>
</li></ul><style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>

</section>
<section id="hosting" class="slide level2">
<h2>Hosting</h2>
<p>Posit Connect</p>
<ul>
<li class="fragment">Manage user access <i class="fa-solid fa-users"></i></li>
<li class="fragment">RStudio, VSCode integration (<i class="fa-brands fa-python" aria-label="python"></i> and <i class="fa-brands fa-r-project" aria-label="r-project"></i>)</li>
<li class="fragment">Can handle secrets <i class="fa-solid fa-key"></i></li>
<li class="fragment">No limits on views <i class="fa-solid fa-binoculars"></i></li>
<li class="fragment">We deploy a separate app per model version
<ul>
<li class="fragment">Unambiguous</li>
<li class="fragment">Backwards compatability</li>
</ul></li>
</ul>
<aside class="notes">
<ul>
<li><p>There are various options for where to host Shiny apps so that they are available to end users through the browser. shinyapps.io for example. They vary a lot. We had a number of specific requirements for the hosting of the NHP model, including</p></li>
<li><p>User access</p></li>
<li><p>being compatible with different languages and GUIs that we use in the team</p></li>
<li><p>Elegantly and safely handling secrets</p></li>
<li><p>No limits on views</p>
</li></ul><style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>

</section>
<section id="outputs" class="slide level2">
<h2>Outputs</h2>
<p>Many formats:</p>
<ul class="task-list">
<li><label><input type="checkbox">CSV</label></li>
<li><label><input type="checkbox">JSON</label></li>
<li><label><input type="checkbox">MS Word (using {<a href="https://davidgohel.github.io/officer/">officeR</a>})</label></li>
<li><label><input type="checkbox"><a href="https://connect.strategyunitwm.nhs.uk/nhp/v3-1/outputs/?%2BQAjkHBl%2BCKbvWFP6tv2v9Z1Nwt0eMs37GWGRshs2qNLvhbkJUzBsJOIvxNG6UtLnTSziKj5CNZgT95laTdBbhNfzEUb%2BDZUuY%2FerNLYAx8%3D">Outputs app</a></label></li>
<li><label><input type="checkbox"><a href="https://github.com/The-Strategy-Unit/nhp_project_information">Project information</a> Quarto website</label></li>
</ul>
<p>We use a <a href="https://github.com/The-Strategy-Unit/su-brand-yml">_brand.yml</a> to help easily maintain style format of outputs (Quarto and Shiny).</p>
<aside class="notes">
<ul>
<li><p>The main way information flows out of the NHP model is via the outputs app, which also provides the functionality to download results into a spreadsheet software of your choice through CSV files.</p></li>
<li><p>The JSON files we’ve discussed are also produced and stored and users can ask us for them if useful</p></li>
<li><p>We produce templated reports in Microsoft Word for schemes, allowing them the comfort and accessibility of familiar software without greatly sacrificing the programmatic and RAP-compliant nature of our work.</p></li>
<li><p>And our Quarto website holding the project information is a key tool for dissemination of info. Its repo is open, so you can go and look at all the code used to create it.</p></li>
<li><p>In essence we will aim to provide outputs that best meet the needs of our model users, to maximise the impact of the modelling and communicate the uncertainty around estimates as clearly as we can.</p></li>
<li><p>We also make use of ‘brand.yml’ to be consistent in the appearance of our NHP outputs. You can see this yaml file on our github, with an informative README that contains useful links to guidance around branding and usage.</p>
</li></ul><style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>

</section>
<section id="reproducible-analytical-pipeline-rap-principles" class="slide level2">
<h2>Reproducible Analytical Pipeline (RAP) principles</h2>
<h3 id="data-versioning">Data versioning</h3>
<p>Data and model follow the same semantic versioning<sup>1</sup>.</p>
<p><img data-src="model_updates.png" style="width:7.5in"></p>
<aside class="notes">
<ul>
<li><p>Now we’re moving into ever-mode nerdy territory. You’ll all be familiar with RAP, what it means and why it matters.</p></li>
<li><p>We as a team are fully on board with those principles of transparency, quality, sharing and continuous improvement.</p></li>
<li><p>One way we do this is through version control - not only of the code, but of the data too.</p></li>
<li><p>We keep a public log of all changes to the model, viewable at the link below on our project information site, which is a Quarto website whose deployment is handled by GitHub Actions.</p></li>
<li><p>The code is versioned semantically, like usual software is, following the major-minor-patch naming convention. We are currently on version 3.4 of the model</p>
</li></ul><style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<h2 id="section-5"></h2>

<p><img data-src="data_log.png"></p>
<p><a href="https://connect.strategyunitwm.nhs.uk/nhp/project_information/data_extraction/data_log.html">Data Log</a></p>
<aside class="notes">
<ul>
<li><p>On another page of the Quarto website, we have a data log. As you can see, the data are named the same as the model versions, and we have history here going right back to the begining of the model lifespan.</p></li>
<li><p>Release notes are linked to and held on the nhp_data repository, which is also open source. Lets follow one of these release notes links to see the kinds of information stored.</p>
</li></ul><style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<h2 id="section-6"></h2>

<p><img data-src="github.png"></p>
<p><a href="https://github.com/The-Strategy-Unit?view_as=public">The Strategy Unit GitHub</a></p>
<aside class="notes">
<ul>
<li><p>Here in GitHub you can see the release notes for the current version of the model, v3.4.0. These notes are partly auto-generated by GitHub through collating the pull request comments on the elements merged to create this release, but we also might overwrite or simplify some things.</p></li>
<li><p>For instance we can see that Tom merged PR number 89 that replace the AEC mitigators with the new SDEC ones. I can click on this link to go to that merged PR and see all the details, timeline and conversations around it.</p></li>
<li><p>The full changelog also contains all the commits relevant to this new model version.</p>
</li></ul><style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>

<aside><ol class="aside-footnotes"><li id="fn1"><p><a href="https://connect.strategyunitwm.nhs.uk/nhp/project_information/project_plan_and_summary/model_updates.html">Model Updates</a></p></li></ol></aside></section>
<section id="rap" class="slide level2">
<h2>RAP</h2>
<ul>
<li class="fragment">Modularised code</li>
<li class="fragment">Styling and Linting</li>
<li class="fragment">OPEN source code</li>
<li class="fragment">Version control</li>
<li class="fragment">Environment management:</li>
<li class="fragment"><a href="https://www.docker.com/">Docker</a></li>
<li class="fragment"><a href="https://rstudio.github.io/renv/">{renv}</a></li>
<li class="fragment"><a href="https://anaconda.org/anaconda/conda">conda</a></li>
</ul>
<aside class="notes">
<ul>
<li><p>There’s endless approaches and tooling you can use to adhere to RAP principles.</p></li>
<li><p>The selections we use are not static, we consciously improve and adapt over time</p></li>
<li><p>Modularising code we’ve spoken about, we try to take this approach wherever it makes sense (almost everywhere)</p></li>
<li><p>We use stylers like Air, which can be set to run every time you submit a PR to ensure that you are conforming to internally consistent style rules</p></li>
<li><p>Similarly with linting, this helps us be consistent in our code syntax and semantics.</p></li>
<li><p>As you’ve seen a lot already today, we code in the open. This can be scary to start with, but if your team follow advice around keeping secrets secret etc, and feel supported, its not too difficult to do.</p></li>
<li><p>Version control we’ve talked a lot about- handled using Git.</p></li>
<li><p>Reproducibility requires environment management. With the model this means using Docker to spin up a fully-resourced environment every time</p></li>
<li><p>We were using {renv} for some repos, but having shifted to building these as packages we no longer need to, and instead rely on the DESCRIPTION file.</p></li>
<li><p>with everything else we use conda to manage package dependencies.</p>
</li></ul><style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>

</section>
<section id="rap-continued" class="slide level2">
<h2>RAP continued</h2>
<ul>
<li>Documentation
<ul>
<li><a href="https://connect.strategyunitwm.nhs.uk/nhp/project_information/">Project Information</a></li>
<li>READMEs on <a href="https://github.com/The-Strategy-Unit?view_as=public">GitHub</a></li>
<li>Docstrings, packaged apps (<a href="https://thinkr-open.github.io/golem/">golem</a>)</li>
</ul></li>
<li>JSON schema <span style="color:blue;"><strong>{✔❌}</strong></span> for validating the parameters passed to the model</li>
</ul>
<aside class="notes">
<ul>
<li><p>Keeping clear, concise, up to date documentation is essential.</p></li>
<li><p>All the information about NHP is on our project information website.</p></li>
<li><p>We adhere to guidelines around having comprehensive README files</p></li>
<li><p>Our apps, built as packages, have documentation kept up to date, which is easily done using devtools::document() function as you would when building a package. This means that all functions whose logic has been extrapolated out to separate R files should be automatically documented by picking up the Roxygen comments.</p></li>
<li><p>Another RAP element that we’ve very recently added is JSON schema - a way of validating the content of a JSON file before it is run through the model - this was deemed a good idea as on some test runs we had mistakenly put nonsensical values in the JSON, which didn’t throw an error when run through the model, but caused silly results. Having a check against a schema prevents this.</p>
</li></ul><style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>

</section>
<section id="deployment-cicd" class="slide level2">
<h2>Deployment (CI/CD)</h2>
<p>How do we maintain <span style="color:blue;">clean</span>, <span style="color:green;">safe</span>, <span style="color:red;">working</span> code, centrally, when we have open repositories and up to <u>10 people</u> collaborating on maintaining that code alongside its active deployment?</p>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong><em>Continuous Integration</em></strong></p>
<p>Automated checks, tests when merging code into main</p>
<ul>
<li>On pull request submission</li>
<li>On merge to main</li>
</ul>
</div><div class="column" style="width:50%;">
<div style="background-color: #D3D3D3">
<p><strong><em>Continuous Deployment</em></strong></p>
<p>Automated checks and tests when deploying (to dev or to prod)</p>
<ul>
<li>On merge to main</li>
<li>On release</li>
</ul>
</div>
</div></div>
</section>
<section id="github-actions" class="slide level2">
<h2>GitHub Actions</h2>
<p>Actions like:</p>
<ul>
<li>Formatting ({<a href="https://www.tidyverse.org/blog/2025/02/air/#:~:text=How%20does%20Air%20decide%20how,we%20occasionally%20deviate%20from%20these.">Air</a>}) to pick up stylistic inconsistencies</li>
<li>Linting - for logical, syntactic and stylistic issues</li>
<li>Rendering the README.Rmd</li>
<li>Package checks (benefits of creating a Shiny app as a package)</li>
<li>Deploys to a ‘preview’ site</li>
<li>Assess code coverage ({<a href="https://about.codecov.io/">codecov</a>})</li>
</ul>
<aside class="notes">
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section-7" class="slide level2">
<h2></h2>

<img data-src="Actions.png" class="r-stretch"><aside class="notes">
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="break-time" class="slide level2">
<h2>Break time! <i class="fa-solid fa-mug-saucer"></i></h2>
<div class="quarto-layout-panel" data-layout-nrow="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="CB.jpg" style="height:2in"></p>
<figcaption>Chris Beeley</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="CW.jpg" style="height:2in"></p>
<figcaption>Claire Welsh</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="NS.png" style="height:2in"></p>
<figcaption>Natasha Stephenson</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="TJ.png" style="height:2in"></p>
<figcaption>Tom Jemmett</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="MD.jpg" style="height:2in"></p>
<figcaption>Matt Dray</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="YH.jpg" style="height:2in"></p>
<figcaption>YiWen Hon</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="OM.png" style="height:2in"></p>
<figcaption>Ozayr Mohammed</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="RD.jpg" style="height:2in"></p>
<figcaption>Rhian Davies</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="how-we-work" class="slide level2">
<h2>How we work</h2>
<p>We are <span style="color:red;"><strong>A</strong></span><span style="color:orange;"><strong>G</strong></span><span style="color:green;"><strong>I</strong></span><span style="color:blue;"><strong>L</strong></span><span style="color:purple;"><strong>E</strong></span>, and use <a href="https://www.scrum.org/resources/what-scrum-module">Scrum</a> (light)</p>
<ul>
<li class="fragment">3 week sprints with 1 week fallow</li>
<li class="fragment">Weekly sprint catch-up meetings</li>
<li class="fragment">Kickoff and retro</li>
<li class="fragment">Promote T-shape expertise while reducing ‘bus-factor’</li>
<li class="fragment">Transparent prioritisation processes</li>
<li class="fragment">Distinct team roles</li>
</ul>
<aside class="notes">
<ul>
<li><p>Scrum is a software development project management approach. We pick and choose the elements of these approaches as we see fit.</p></li>
<li><p>The reason for using it is to help us coordinate our activities across all these codebases and through all this complexity. It also helps us to push back on work if needed.</p></li>
<li><p>We have recently shortened the length of our sprints to release code more frequently and prevent large, tricky pieces of work becoming blocked for too long. We’re being agile about trying this out!</p></li>
<li><p>At the start of each sprint we hold a meeting to go through all the work elements to be delivered in that sprint, decide who is doing what, and ensure that all issues are clear and complete enough to avoid ambiguity. We need to have sub-issues that accurately reflect the quantity and distribution of work coming down the line to help us prioritise.</p></li>
<li><p>Every week on Monday we catch-up around the sprint and talk about whether we are on course, what needs to happen next and ensure we are sticking to deadlines.</p></li>
<li><p>At the end of every sprint we have an open discussion about what went well or otherwise.</p></li>
<li><p>The team needs to have deep expertise, but each person’s expertise covers different areas. The ‘T-shape’ indicates a broad understanding/skillset that enables work sharing and reduces bus-factor, and the downwards element shows that depth of expertise that we call upon - things like data engineering, statistics, documentation, app building, project management.</p></li>
<li><p>How we decide what we work on when is an evolving area. We aim to have logical, transparent tools for prioritising our work plan, which is sufficiently disseminated that stakeholders feel ‘in-the-loop’ and our staff do not burn out.</p></li>
<li><p>We also use Scrum principles around nominated roles within the team, I’ll go through the main ones now.</p>
</li></ul><style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>

</section>
<section id="section-8" class="slide level2">
<h2></h2>
<ul>
<li><strong>Scrum master</strong> : <em>keeping the sprint on track</em></li>
<li><strong>Product owner</strong> : <em>steer work towards the goals</em></li>
<li><strong>Project director</strong> : <em>overall responsibility for delivery</em></li>
<li><strong>Development board</strong> : <em>define the goals and priorities</em></li>
<li><strong>QA</strong> : <em>oversee quality</em></li>
</ul>
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Tip</strong></p>
</div>
<div class="callout-content">
<p>Roles have enough specificity to provide clarity, but are also shared. Flat management structure.</p>
</div>
</div>
</div>
<aside class="notes">
<ul>
<li><p>These roles are fundamental to being able to operate across all the different elements discussed, while continuously upskilling and making sure everyone is happy and healthy.</p></li>
<li><p>Being agile means - We welcome input at any stage and can act on it because of the attitude and setup we have - We are not thrown off course by even late-stage changes (although these should be rare if our prioritisation frameworks are working as planned) - We collaborate with anyone that it makes sense to do so, drawing on expertise that benefits the product - Continuous improvement in both the work output and the team’s skills are emphasised.</p></li>
</ul>
<p>Lets look at some of the actual processes we use to achieve all this.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="agile-and-scrum-in-github" class="slide level2">
<h2>Agile and Scrum in GitHub</h2>
<p>Leverage a LOT of GitHub’s excellent tooling</p>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li>Projects</li>
<li>Issues with bespoke labelling</li>
<li>Branch protection rules</li>
<li><span style="color:red;">CODEOWNERS</span></li>
<li>Clear and consistent collaboration guidance</li>
<li>Checklists</li>
</ul>
</div><div class="column" style="width:50%;">
<p><img data-src="labels.png"></p>
</div></div>
<aside class="notes">
<p>Bespoke labelling is a very active area for development for us working on NHP.</p>
<p>We have a LOT of opinions, sets of priorities and dependencies to incorporate, organise and understand</p>
<ul>
<li>Creating, modifying and revising labelling strategies is key to team understanding and clarity.</li>
<li>They avoid clashing of scheduled priorities and help resolve conflicts</li>
<li>We create label sets to denote things like
<ul>
<li>Our priorities within DS</li>
<li>Our dev board’s priorities</li>
<li>Stages of production for new elements</li>
<li>Sign-off status</li>
<li>Whether we could/should/must/won’t</li>
<li>To get an idea of the scope of any issue</li>
<li>Urgency versus importance</li>
</ul>
</li></ul><style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>

</section>
<section id="codeowners" class="slide level2">
<h2>CODEOWNERS</h2>
<p>A simple but powerful idea!</p>

<img data-src="codeowners.png" class="r-stretch"><aside class="notes">
<ul>
<li><p>The more code and repos you have, the more likely you are to miss things, for issues to go stale, and for best practice to fall by the wayside.</p></li>
<li><p>To avoid this, each repo has two nominated CODEOWNERS, whose responsibility it is to know about the content, understand its purpose, be able to debug it when necessary, and to keep on top of issues related to it - prioritising these as makes sense and delegating that work if necessary.</p></li>
<li><p>These people are automatically chosen as reviewers for any PR seeking to merge to main.</p></li>
<li><p>Although you can nominate a team to be a CODEOWNER, we’ve opted not to do this to avoid everybody getting ‘spammed’ with emails whenever a PR is submitted to one of our repos - our inboxes are full enough!</p>
</li></ul><style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>

</section>
<section id="product-team" class="slide level2">
<h2>Product Team</h2>
<p>‘The model’ is a <u>product</u> - it has current and potential use cases and user groups.</p>
<p>We need a team responsible for understanding the software business <i class="fa-solid fa-briefcase"></i> as well as the software product 🚀.</p>
<p><em>“What should we build next and why?”</em></p>
</section>
<section id="product-team-members" class="slide level2">
<h2>Product Team Members</h2>
<ul>
<li>Product Owner</li>
<li>Product Manager</li>
<li>Customer Engagement</li>
<li>Project Director</li>
</ul>
<div class="quarto-layout-panel" data-layout-nrow="1">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<p><img data-src="NS.png" style="width:2in"> <img data-src="CW.jpg" style="width:2in"> <img data-src="JC.jpg" style="width:2in"> <img data-src="CB.jpg" style="width:2in"></p>
</div>
</div>
</div>
</section>
<section id="information-management" class="slide level2">
<h2>Information management</h2>
<p>🗣 Info IN</p>
<p>Inbox, user feedback forms, button on apps, videoed interviews, roundtable, ad hoc.</p>
<p>📣 Info OUT</p>
<p>Project information site, GitHub, how-to videos, conference and meeting presentations, blogs.</p>
<p>To ensure that:</p>
<ul>
<li>User needs guide what we build</li>
<li>We help (current and future) users know what we have built and are building</li>
</ul>
</section>
<section id="thank-you" class="title-slide slide level1 inverse center">
<h1>Thank you</h1>
<p>NHP Demand and Capacity (D&amp;C) Model: A Technical Deep Dive for Data Scientists</p>
<ul>
<li><a href="mailto:claire.welsh8@nhs.net" target="_blank">Claire Welsh</a></li>
<li><a href="https://www.strategyunitwm.nhs.uk/">The Strategy Unit</a>, <a href="https://www.midlandsandlancashirecsu.nhs.uk/">NHS ML</a></li>
</ul>


</section>


    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p>Learn more about <a href="https://www.strategyunitwm.nhs.uk/">The Strategy Unit</a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': true,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":false},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp("https:\/\/the-strategy-unit\.github\.io\/data_science");
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>