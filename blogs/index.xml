<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Data Science @ The Strategy Unit</title>
<link>https://the-strategy-unit.github.io/data_science/blogs/index.html</link>
<atom:link href="https://the-strategy-unit.github.io/data_science/blogs/index.xml" rel="self" type="application/rss+xml"/>
<description>Blogs from the Data Science Team at The Strategy Unit</description>
<generator>quarto-1.3.450</generator>
<lastBuildDate>Wed, 17 Jan 2024 00:00:00 GMT</lastBuildDate>
<item>
  <title>Nearest neighbour imputation</title>
  <dc:creator>Jacqueline Grout</dc:creator>
  <link>https://the-strategy-unit.github.io/data_science/blogs/posts/2024-01-17_nearest_neighbour.html</link>
  <description><![CDATA[ 



<div class="page-columns page-full"><p>Recently I have been gathering data by GP practice, from a variety of different sources. The ultimate purpose of my project is to be able to report at an ICB/sub-ICB level<sup>1</sup>. The various datasets cover different timescales and consequently changes in GP practices over time have left me with mismatching datasets.</p><div class="no-row-height column-margin column-container"><li id="fn1"><p><sup>1</sup>&nbsp;An ICB (Integrated Care Board) is a statutory NHS organisation responsible for planning health services for their local populations</p></li></div></div>
<p>My approach has been to take as the basis of my project a recent GP List. Later in my project I want to perform calculations at a GP practice level based on an underlying health need and the data for this need is a CHD prevalence value from a dataset that is around 8 years old, and for which there is no update or alternative. From my recent list of 6454 practices, when I match to the need dataset, I am left with 151 practices without a value for need. If I remove these practices from the analysis then this could impact the analysis by sub-ICB since often a group of practices in the same area could be subject to changes, mergers and reorganisation.</p>
<p>Here’s the packages and some demo objects to work with to create an example for two practices:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Packages</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(sf)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidygeocoder)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(leaflet)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(viridisLite)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(gt)</span>
<span id="cb1-8"></span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create some data with two practices with no need data </span></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># and a selection of practices locally with need data</span></span>
<span id="cb1-11">practices <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tribble</span>(</span>
<span id="cb1-12">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>practice_code, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>postcode, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>has_orig_need, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>value,</span>
<span id="cb1-13">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P1"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CV1 4FS"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,</span>
<span id="cb1-14">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P2"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CV1 3GB"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7.3</span>,</span>
<span id="cb1-15">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P3"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CV11 5TW"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.9</span>,</span>
<span id="cb1-16">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P4"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CV6 3HZ"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7.1</span>,</span>
<span id="cb1-17">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P5"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CV6 1HS"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7.7</span>,</span>
<span id="cb1-18">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P6"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CV6 5DF"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.2</span>,</span>
<span id="cb1-19">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P7"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CV6 3FA"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7.9</span>,</span>
<span id="cb1-20">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P8"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CV1 2DL"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7.5</span>,</span>
<span id="cb1-21">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P9"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CV1 4JH"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7.7</span>,</span>
<span id="cb1-22">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P10"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CV10 0GQ"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7.5</span>,</span>
<span id="cb1-23">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P11"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CV10 0JH"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7.8</span>,</span>
<span id="cb1-24">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P12"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CV11 5QT"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,</span>
<span id="cb1-25">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P13"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CV11 6AB"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7.6</span>,</span>
<span id="cb1-26">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P14"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CV6 4DD"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7.9</span></span>
<span id="cb1-27">) </span>
<span id="cb1-28"></span>
<span id="cb1-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get domain of numeric data</span></span>
<span id="cb1-30">(domain <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">range</span>(practices<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>has_orig_need))</span>
<span id="cb1-31"></span>
<span id="cb1-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># make a colour palette</span></span>
<span id="cb1-33">pal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colorNumeric</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">viridis</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">domain =</span> domain)</span></code></pre></div>
</details>
</div>
<div class="page-columns page-full"><p>To provide a suitable estimate of need for the newer practices without values, all the practices in the dataset were geocoded<sup>2</sup> using the <code>geocode</code> function from the {tidygeocoder} package.</p><div class="no-row-height column-margin column-container"><li id="fn2"><p><sup>2</sup>&nbsp;Geocoding is the process of converting addresses (often the postcode) into geographic coordinates (such as latitude and longitude) that can be plotted on a map.</p></li></div></div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">practices <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> practices <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">row_number</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geocode</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">postalcode =</span> postcode) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">coords =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"long"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lat"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4326</span>)</span></code></pre></div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">practices <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gt</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">

<div id="lubipwmmke" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#lubipwmmke table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#lubipwmmke thead, #lubipwmmke tbody, #lubipwmmke tfoot, #lubipwmmke tr, #lubipwmmke td, #lubipwmmke th {
  border-style: none;
}

#lubipwmmke p {
  margin: 0;
  padding: 0;
}

#lubipwmmke .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#lubipwmmke .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#lubipwmmke .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#lubipwmmke .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#lubipwmmke .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lubipwmmke .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lubipwmmke .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lubipwmmke .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#lubipwmmke .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#lubipwmmke .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#lubipwmmke .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#lubipwmmke .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#lubipwmmke .gt_spanner_row {
  border-bottom-style: hidden;
}

#lubipwmmke .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#lubipwmmke .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#lubipwmmke .gt_from_md > :first-child {
  margin-top: 0;
}

#lubipwmmke .gt_from_md > :last-child {
  margin-bottom: 0;
}

#lubipwmmke .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#lubipwmmke .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#lubipwmmke .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#lubipwmmke .gt_row_group_first td {
  border-top-width: 2px;
}

#lubipwmmke .gt_row_group_first th {
  border-top-width: 2px;
}

#lubipwmmke .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lubipwmmke .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#lubipwmmke .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#lubipwmmke .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lubipwmmke .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lubipwmmke .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#lubipwmmke .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#lubipwmmke .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#lubipwmmke .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lubipwmmke .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lubipwmmke .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lubipwmmke .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lubipwmmke .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lubipwmmke .gt_left {
  text-align: left;
}

#lubipwmmke .gt_center {
  text-align: center;
}

#lubipwmmke .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#lubipwmmke .gt_font_normal {
  font-weight: normal;
}

#lubipwmmke .gt_font_bold {
  font-weight: bold;
}

#lubipwmmke .gt_font_italic {
  font-style: italic;
}

#lubipwmmke .gt_super {
  font-size: 65%;
}

#lubipwmmke .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#lubipwmmke .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#lubipwmmke .gt_indent_1 {
  text-indent: 5px;
}

#lubipwmmke .gt_indent_2 {
  text-indent: 10px;
}

#lubipwmmke .gt_indent_3 {
  text-indent: 15px;
}

#lubipwmmke .gt_indent_4 {
  text-indent: 20px;
}

#lubipwmmke .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="practice_code">practice_code</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="postcode">postcode</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="has_orig_need">has_orig_need</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="value">value</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="id">id</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="geometry">geometry</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="practice_code" class="gt_row gt_left">P1</td>
<td headers="postcode" class="gt_row gt_left">CV1 4FS</td>
<td headers="has_orig_need" class="gt_row gt_right">0</td>
<td headers="value" class="gt_row gt_right">NA</td>
<td headers="id" class="gt_row gt_right">1</td>
<td headers="geometry" class="gt_row gt_center">c(-1.50686326666667, 52.4141089666667)</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P2</td>
<td headers="postcode" class="gt_row gt_left">CV1 3GB</td>
<td headers="has_orig_need" class="gt_row gt_right">1</td>
<td headers="value" class="gt_row gt_right">7.3</td>
<td headers="id" class="gt_row gt_right">2</td>
<td headers="geometry" class="gt_row gt_center">c(-1.51888, 52.4034199)</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P3</td>
<td headers="postcode" class="gt_row gt_left">CV11 5TW</td>
<td headers="has_orig_need" class="gt_row gt_right">1</td>
<td headers="value" class="gt_row gt_right">6.9</td>
<td headers="id" class="gt_row gt_right">3</td>
<td headers="geometry" class="gt_row gt_center">c(-1.46746, 52.519)</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P4</td>
<td headers="postcode" class="gt_row gt_left">CV6 3HZ</td>
<td headers="has_orig_need" class="gt_row gt_right">1</td>
<td headers="value" class="gt_row gt_right">7.1</td>
<td headers="id" class="gt_row gt_right">4</td>
<td headers="geometry" class="gt_row gt_center">c(-1.52231, 52.42367)</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P5</td>
<td headers="postcode" class="gt_row gt_left">CV6 1HS</td>
<td headers="has_orig_need" class="gt_row gt_right">1</td>
<td headers="value" class="gt_row gt_right">7.7</td>
<td headers="id" class="gt_row gt_right">5</td>
<td headers="geometry" class="gt_row gt_center">c(-1.52542, 52.41989)</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P6</td>
<td headers="postcode" class="gt_row gt_left">CV6 5DF</td>
<td headers="has_orig_need" class="gt_row gt_right">1</td>
<td headers="value" class="gt_row gt_right">8.2</td>
<td headers="id" class="gt_row gt_right">6</td>
<td headers="geometry" class="gt_row gt_center">c(-1.498344825, 52.4250186)</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P7</td>
<td headers="postcode" class="gt_row gt_left">CV6 3FA</td>
<td headers="has_orig_need" class="gt_row gt_right">1</td>
<td headers="value" class="gt_row gt_right">7.9</td>
<td headers="id" class="gt_row gt_right">7</td>
<td headers="geometry" class="gt_row gt_center">c(-1.51787, 52.43135)</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P8</td>
<td headers="postcode" class="gt_row gt_left">CV1 2DL</td>
<td headers="has_orig_need" class="gt_row gt_right">1</td>
<td headers="value" class="gt_row gt_right">7.5</td>
<td headers="id" class="gt_row gt_right">8</td>
<td headers="geometry" class="gt_row gt_center">c(-1.49105, 52.40582)</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P9</td>
<td headers="postcode" class="gt_row gt_left">CV1 4JH</td>
<td headers="has_orig_need" class="gt_row gt_right">1</td>
<td headers="value" class="gt_row gt_right">7.7</td>
<td headers="id" class="gt_row gt_right">9</td>
<td headers="geometry" class="gt_row gt_center">c(-1.50653, 52.41953)</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P10</td>
<td headers="postcode" class="gt_row gt_left">CV10 0GQ</td>
<td headers="has_orig_need" class="gt_row gt_right">1</td>
<td headers="value" class="gt_row gt_right">7.5</td>
<td headers="id" class="gt_row gt_right">10</td>
<td headers="geometry" class="gt_row gt_center">c(-1.52197, 52.54074)</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P11</td>
<td headers="postcode" class="gt_row gt_left">CV10 0JH</td>
<td headers="has_orig_need" class="gt_row gt_right">1</td>
<td headers="value" class="gt_row gt_right">7.8</td>
<td headers="id" class="gt_row gt_right">11</td>
<td headers="geometry" class="gt_row gt_center">c(-1.5163199, 52.53723)</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P12</td>
<td headers="postcode" class="gt_row gt_left">CV11 5QT</td>
<td headers="has_orig_need" class="gt_row gt_right">0</td>
<td headers="value" class="gt_row gt_right">NA</td>
<td headers="id" class="gt_row gt_right">12</td>
<td headers="geometry" class="gt_row gt_center">c(-1.46927, 52.51899)</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P13</td>
<td headers="postcode" class="gt_row gt_left">CV11 6AB</td>
<td headers="has_orig_need" class="gt_row gt_right">1</td>
<td headers="value" class="gt_row gt_right">7.6</td>
<td headers="id" class="gt_row gt_right">13</td>
<td headers="geometry" class="gt_row gt_center">c(-1.45822, 52.52682)</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P14</td>
<td headers="postcode" class="gt_row gt_left">CV6 4DD</td>
<td headers="has_orig_need" class="gt_row gt_right">1</td>
<td headers="value" class="gt_row gt_right">7.9</td>
<td headers="id" class="gt_row gt_right">14</td>
<td headers="geometry" class="gt_row gt_center">c(-1.50832, 52.44104)</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<p>This map shows the practices, purple are the practices with no need data and yellow are practices with need data available.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># make map to display practices</span></span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">leaflet</span>(practices) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">addTiles</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">addCircleMarkers</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pal</span>(has_orig_need)) </span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item" id="htmlwidget-ebefab622e89070bb75e" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-ebefab622e89070bb75e">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org/copyright/\">OpenStreetMap<\/a>,  <a href=\"https://opendatacommons.org/licenses/odbl/\">ODbL<\/a>"}]},{"method":"addCircleMarkers","args":[[52.41410896666667,52.4034199,52.519,52.42367,52.41989,52.4250186,52.43135,52.40582,52.41953,52.54074,52.53723,52.51899,52.52682,52.44104],[-1.506863266666667,-1.51888,-1.46746,-1.52231,-1.52542,-1.498344825,-1.51787,-1.49105,-1.50653,-1.52197,-1.5163199,-1.46927,-1.45822,-1.50832],10,null,null,{"interactive":true,"className":"","stroke":true,"color":["#440154","#FDE725","#FDE725","#FDE725","#FDE725","#FDE725","#FDE725","#FDE725","#FDE725","#FDE725","#FDE725","#440154","#FDE725","#FDE725"],"weight":5,"opacity":0.5,"fill":true,"fillColor":["#440154","#FDE725","#FDE725","#FDE725","#FDE725","#FDE725","#FDE725","#FDE725","#FDE725","#FDE725","#FDE725","#440154","#FDE725","#FDE725"],"fillOpacity":0.2},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[52.4034199,52.54074],"lng":[-1.52542,-1.45822]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>The data was split into those with, and without, a value for need. Using <code>st_join</code> from the {sf} package to join those without, and those with, a value for need, using the geometry to find all those within 1500m (1.5km).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">no_need <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> practices <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(has_orig_need <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb5-3"></span>
<span id="cb5-4">with_need <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> practices <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(has_orig_need <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb5-6"></span>
<span id="cb5-7"></span>
<span id="cb5-8">neighbours <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> no_need <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">no_need_postcode =</span> postcode,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">no_need_prac_code=</span>practice_code) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_join</span>(with_need, st_is_within_distance, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1500</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_drop_geometry</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(id, no_need_postcode,no_need_prac_code) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">inner_join</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> with_need, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">join_by</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>)) </span></code></pre></div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">leaflet</span>(neighbours) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">addTiles</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">addCircleMarkers</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"purple"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">addMarkers</span>(  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.50686326666667</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">52.4141089666667</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">popup =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Practice with no data"</span></span>
<span id="cb6-5">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">addCircles</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.50686326666667</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">52.4141089666667</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">radius=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1500</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">addMarkers</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.46927</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">52.51899</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">popup =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Practice with no data"</span></span>
<span id="cb6-8">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">addCircles</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.46927</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">52.51899</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">radius=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1500</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item" id="htmlwidget-17b16569ffc7a6cd445c" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-17b16569ffc7a6cd445c">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org/copyright/\">OpenStreetMap<\/a>,  <a href=\"https://opendatacommons.org/licenses/odbl/\">ODbL<\/a>"}]},{"method":"addCircleMarkers","args":[[52.4034199,52.519,52.42367,52.41989,52.4250186,52.40582,52.41953,52.52682],[-1.51888,-1.46746,-1.52231,-1.52542,-1.498344825,-1.49105,-1.50653,-1.45822],10,null,null,{"interactive":true,"className":"","stroke":true,"color":"purple","weight":5,"opacity":0.5,"fill":true,"fillColor":"purple","fillOpacity":0.2},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addMarkers","args":[52.4141089666667,-1.50686326666667,null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},"Practice with no data",null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addCircles","args":[52.4141089666667,-1.50686326666667,1500,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null,null]},{"method":"addMarkers","args":[52.51899,-1.46927,null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},"Practice with no data",null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addCircles","args":[52.51899,-1.46927,1500,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null,null]}],"limits":{"lat":[52.4034199,52.52682],"lng":[-1.52542,-1.45822]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>The data for the “neighbours” was grouped by the practice code of those without need data and a mean value was calculated for each practice to generate an estimated value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">neighbours_estimate <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> neighbours <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(no_need_prac_code) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb7-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">need_est=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb7-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_drop_geometry</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(no_need_prac_code,need_est)) </span></code></pre></div>
</div>
<p>The original data was joined back to the “neighbours”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">  practices_with_neighbours_estimate <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> practices <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(neighbours_estimate, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">join_by</span>(practice_code<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>no_need_prac_code))  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_drop_geometry</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(practice_code,need_est))</span></code></pre></div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">  practices_with_neighbours_estimate <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>has_orig_need,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>id) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gt</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">

<div id="lplcojhlxx" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#lplcojhlxx table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#lplcojhlxx thead, #lplcojhlxx tbody, #lplcojhlxx tfoot, #lplcojhlxx tr, #lplcojhlxx td, #lplcojhlxx th {
  border-style: none;
}

#lplcojhlxx p {
  margin: 0;
  padding: 0;
}

#lplcojhlxx .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#lplcojhlxx .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#lplcojhlxx .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#lplcojhlxx .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#lplcojhlxx .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lplcojhlxx .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lplcojhlxx .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lplcojhlxx .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#lplcojhlxx .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#lplcojhlxx .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#lplcojhlxx .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#lplcojhlxx .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#lplcojhlxx .gt_spanner_row {
  border-bottom-style: hidden;
}

#lplcojhlxx .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#lplcojhlxx .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#lplcojhlxx .gt_from_md > :first-child {
  margin-top: 0;
}

#lplcojhlxx .gt_from_md > :last-child {
  margin-bottom: 0;
}

#lplcojhlxx .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#lplcojhlxx .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#lplcojhlxx .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#lplcojhlxx .gt_row_group_first td {
  border-top-width: 2px;
}

#lplcojhlxx .gt_row_group_first th {
  border-top-width: 2px;
}

#lplcojhlxx .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lplcojhlxx .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#lplcojhlxx .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#lplcojhlxx .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lplcojhlxx .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lplcojhlxx .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#lplcojhlxx .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#lplcojhlxx .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#lplcojhlxx .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lplcojhlxx .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lplcojhlxx .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lplcojhlxx .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lplcojhlxx .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lplcojhlxx .gt_left {
  text-align: left;
}

#lplcojhlxx .gt_center {
  text-align: center;
}

#lplcojhlxx .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#lplcojhlxx .gt_font_normal {
  font-weight: normal;
}

#lplcojhlxx .gt_font_bold {
  font-weight: bold;
}

#lplcojhlxx .gt_font_italic {
  font-style: italic;
}

#lplcojhlxx .gt_super {
  font-size: 65%;
}

#lplcojhlxx .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#lplcojhlxx .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#lplcojhlxx .gt_indent_1 {
  text-indent: 5px;
}

#lplcojhlxx .gt_indent_2 {
  text-indent: 10px;
}

#lplcojhlxx .gt_indent_3 {
  text-indent: 15px;
}

#lplcojhlxx .gt_indent_4 {
  text-indent: 20px;
}

#lplcojhlxx .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="practice_code">practice_code</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="postcode">postcode</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="value">value</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="need_est">need_est</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="practice_code" class="gt_row gt_left">P1</td>
<td headers="postcode" class="gt_row gt_left">CV1 4FS</td>
<td headers="value" class="gt_row gt_right">NA</td>
<td headers="need_est" class="gt_row gt_right">7.583333</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P2</td>
<td headers="postcode" class="gt_row gt_left">CV1 3GB</td>
<td headers="value" class="gt_row gt_right">7.3</td>
<td headers="need_est" class="gt_row gt_right">NA</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P3</td>
<td headers="postcode" class="gt_row gt_left">CV11 5TW</td>
<td headers="value" class="gt_row gt_right">6.9</td>
<td headers="need_est" class="gt_row gt_right">NA</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P4</td>
<td headers="postcode" class="gt_row gt_left">CV6 3HZ</td>
<td headers="value" class="gt_row gt_right">7.1</td>
<td headers="need_est" class="gt_row gt_right">NA</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P5</td>
<td headers="postcode" class="gt_row gt_left">CV6 1HS</td>
<td headers="value" class="gt_row gt_right">7.7</td>
<td headers="need_est" class="gt_row gt_right">NA</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P6</td>
<td headers="postcode" class="gt_row gt_left">CV6 5DF</td>
<td headers="value" class="gt_row gt_right">8.2</td>
<td headers="need_est" class="gt_row gt_right">NA</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P7</td>
<td headers="postcode" class="gt_row gt_left">CV6 3FA</td>
<td headers="value" class="gt_row gt_right">7.9</td>
<td headers="need_est" class="gt_row gt_right">NA</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P8</td>
<td headers="postcode" class="gt_row gt_left">CV1 2DL</td>
<td headers="value" class="gt_row gt_right">7.5</td>
<td headers="need_est" class="gt_row gt_right">NA</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P9</td>
<td headers="postcode" class="gt_row gt_left">CV1 4JH</td>
<td headers="value" class="gt_row gt_right">7.7</td>
<td headers="need_est" class="gt_row gt_right">NA</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P10</td>
<td headers="postcode" class="gt_row gt_left">CV10 0GQ</td>
<td headers="value" class="gt_row gt_right">7.5</td>
<td headers="need_est" class="gt_row gt_right">NA</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P11</td>
<td headers="postcode" class="gt_row gt_left">CV10 0JH</td>
<td headers="value" class="gt_row gt_right">7.8</td>
<td headers="need_est" class="gt_row gt_right">NA</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P12</td>
<td headers="postcode" class="gt_row gt_left">CV11 5QT</td>
<td headers="value" class="gt_row gt_right">NA</td>
<td headers="need_est" class="gt_row gt_right">7.250000</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P13</td>
<td headers="postcode" class="gt_row gt_left">CV11 6AB</td>
<td headers="value" class="gt_row gt_right">7.6</td>
<td headers="need_est" class="gt_row gt_right">NA</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P14</td>
<td headers="postcode" class="gt_row gt_left">CV6 4DD</td>
<td headers="value" class="gt_row gt_right">7.9</td>
<td headers="need_est" class="gt_row gt_right">NA</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<p>Finally, an updated data frame was created of the need data using the actual need for the practice where available, otherwise using estimated need.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">practices_with_neighbours_estimate <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> practices_with_neighbours_estimate <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb10-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">need_to_use =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(value<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> value,</span>
<span id="cb10-3">                                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.default =</span> need_est)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb10-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(practice_code,need_to_use) </span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">

<div id="rfjhgneazp" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#rfjhgneazp table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#rfjhgneazp thead, #rfjhgneazp tbody, #rfjhgneazp tfoot, #rfjhgneazp tr, #rfjhgneazp td, #rfjhgneazp th {
  border-style: none;
}

#rfjhgneazp p {
  margin: 0;
  padding: 0;
}

#rfjhgneazp .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rfjhgneazp .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#rfjhgneazp .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rfjhgneazp .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rfjhgneazp .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rfjhgneazp .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rfjhgneazp .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rfjhgneazp .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rfjhgneazp .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rfjhgneazp .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rfjhgneazp .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rfjhgneazp .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rfjhgneazp .gt_spanner_row {
  border-bottom-style: hidden;
}

#rfjhgneazp .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#rfjhgneazp .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rfjhgneazp .gt_from_md > :first-child {
  margin-top: 0;
}

#rfjhgneazp .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rfjhgneazp .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rfjhgneazp .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#rfjhgneazp .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#rfjhgneazp .gt_row_group_first td {
  border-top-width: 2px;
}

#rfjhgneazp .gt_row_group_first th {
  border-top-width: 2px;
}

#rfjhgneazp .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rfjhgneazp .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#rfjhgneazp .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#rfjhgneazp .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rfjhgneazp .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rfjhgneazp .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rfjhgneazp .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#rfjhgneazp .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rfjhgneazp .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rfjhgneazp .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rfjhgneazp .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rfjhgneazp .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rfjhgneazp .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rfjhgneazp .gt_left {
  text-align: left;
}

#rfjhgneazp .gt_center {
  text-align: center;
}

#rfjhgneazp .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rfjhgneazp .gt_font_normal {
  font-weight: normal;
}

#rfjhgneazp .gt_font_bold {
  font-weight: bold;
}

#rfjhgneazp .gt_font_italic {
  font-style: italic;
}

#rfjhgneazp .gt_super {
  font-size: 65%;
}

#rfjhgneazp .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#rfjhgneazp .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#rfjhgneazp .gt_indent_1 {
  text-indent: 5px;
}

#rfjhgneazp .gt_indent_2 {
  text-indent: 10px;
}

#rfjhgneazp .gt_indent_3 {
  text-indent: 15px;
}

#rfjhgneazp .gt_indent_4 {
  text-indent: 20px;
}

#rfjhgneazp .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="practice_code">practice_code</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="need_to_use">need_to_use</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="practice_code" class="gt_row gt_left">P1</td>
<td headers="need_to_use" class="gt_row gt_right">7.583333</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P2</td>
<td headers="need_to_use" class="gt_row gt_right">7.300000</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P3</td>
<td headers="need_to_use" class="gt_row gt_right">6.900000</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P4</td>
<td headers="need_to_use" class="gt_row gt_right">7.100000</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P5</td>
<td headers="need_to_use" class="gt_row gt_right">7.700000</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P6</td>
<td headers="need_to_use" class="gt_row gt_right">8.200000</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P7</td>
<td headers="need_to_use" class="gt_row gt_right">7.900000</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P8</td>
<td headers="need_to_use" class="gt_row gt_right">7.500000</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P9</td>
<td headers="need_to_use" class="gt_row gt_right">7.700000</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P10</td>
<td headers="need_to_use" class="gt_row gt_right">7.500000</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P11</td>
<td headers="need_to_use" class="gt_row gt_right">7.800000</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P12</td>
<td headers="need_to_use" class="gt_row gt_right">7.250000</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P13</td>
<td headers="need_to_use" class="gt_row gt_right">7.600000</td></tr>
    <tr><td headers="practice_code" class="gt_row gt_left">P14</td>
<td headers="need_to_use" class="gt_row gt_right">7.900000</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<p>For my project, this method has successfully generated a prevalence for 125 of the 151 practices without a need value, leaving just 26 practices without a need. This is using a 1.5 km radius. In each use case there will be a decision to make regarding a more accurate estimate (smaller radius) and therefore fewer matches versus a less accurate estimate (using a larger radius) and therefore more matches.</p>
<div class="page-columns page-full"><p>This approach could be replicated for other similar uses/purposes. A topical example from an SU project is the need to assign population prevalence for hypertension and compare it to current QOF<sup>3</sup> data. Again, the prevalence data is a few years old so we have to move the historical data to fit with current practices and this leaves missing data that can be estimated using this method.</p><div class="no-row-height column-margin column-container"><li id="fn3"><p><sup>3</sup>&nbsp;QOF (Quality and Outcomes Framework) is a voluntary annual reward and incentive programme for all GP practices in England, detailing practice achievement results.</p></li></div></div>




 ]]></description>
  <category>learning</category>
  <guid>https://the-strategy-unit.github.io/data_science/blogs/posts/2024-01-17_nearest_neighbour.html</guid>
  <pubDate>Wed, 17 Jan 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Advent of Code and Test Driven Development</title>
  <dc:creator>YiWen Hon</dc:creator>
  <link>https://the-strategy-unit.github.io/data_science/blogs/posts/2024-01-10-advent-of-code-and-test-driven-development.html</link>
  <description><![CDATA[ 



<p><a href="https://adventofcode.com/">Advent of Code</a> is an annual event, where daily coding puzzles are released from 1st – 24th December. We ran one of our fortnightly Coffee &amp; Coding sessions introducing Advent of Code to people who code in the Strategy Unit, as well as the concept of test-driven development as a potential way of approaching the puzzles.</p>
<p><a href="https://developer.ibm.com/articles/5-steps-of-test-driven-development/">Test-driven development</a> (TDD) is an approach to coding which involves writing the test for a function BEFORE we write the function. This might seem quite counterintuitive, but it makes it easier to identify bugs 🐛 when they are introduced to our code, and ensures that our functions meet all necessary criteria. From my experience, this takes quite a long time to implement and can be quite tedious, but it is definitely worth it overall, especially as your project develops. Testing is also recommended in the <a href="https://nhsdigital.github.io/rap-community-of-practice/introduction_to_RAP/levels_of_RAP/">NHS Reproducible Analytical Pipeline (RAP)</a> guidelines.</p>
<p>An interesting thing to note about TDD is that we’re always expecting our first test to fail, and indeed failing tests are useful and important! If we wrote tests that just passed all the time, this would not be useful at all for our code.</p>
<p>The way that Advent of Code is structured, with test data for each puzzle and an expected test result, makes it very amenable to a test-driven approach. In order to support this, Matt and I created template repositories for a test-driven approach to Advent of Code, in <a href="https://github.com/yiwen-h/aoc_python_template">Python</a> and in <a href="https://github.com/matt-dray/aoc.rstats.template">R</a>.</p>
<p>Our goal when setting this up was to introduce others in the Strategy Unit to both TDD and Advent of Code. Advent of code can be challenging and I personally struggle to get past the first week, but it encourages creative (and maybe even fun?!) approaches to coding problems. I’m glad that we had the chance to explore some of the puzzles together in Coffee &amp; Coding – it was interesting to see so many different approaches to the same problem, and hopefully it also gave us all the chance to practice writing tests.</p>



 ]]></description>
  <category>learning</category>
  <guid>https://the-strategy-unit.github.io/data_science/blogs/posts/2024-01-10-advent-of-code-and-test-driven-development.html</guid>
  <pubDate>Wed, 10 Jan 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Reinstalling R Packages</title>
  <dc:creator>Tom Jemmett</dc:creator>
  <link>https://the-strategy-unit.github.io/data_science/blogs/posts/2023-04-26-reinstalling-r-packages.html</link>
  <description><![CDATA[ 



<p><a href="https://stat.ethz.ch/pipermail/r-announce/2023/000691.html">R 4.3.0 was released</a> last week. Anytime you update R you will probably find yourself in the position where no packages are installed. This is by design - the packages that you have installed may need to be updated and recompiled to work under new versions of R.</p>
<p>You may find yourself wanting to have all of the packages that you previously used, so one approach that some people take is to copy the previous library folder to the new versions folder. This isn’t a good idea and could potentially break your R install.</p>
<p>Another approach would be to export the list of packages in R before updating and then using that list after you have updated R. This can cause issues though if you install from places other than CRAN, e.g.&nbsp;bioconductor, or from GitHub.</p>
<p>Some of these approaches are discussed on the <a href="https://community.rstudio.com/t/reinstalling-packages-on-new-version-of-r/7670/4">RStudio Community Forum</a>. But I prefer an approach of having a “spring clean”, instead only installing the packages that I know that I need.</p>
<p>I maintain a <a href="https://gist.github.com/tomjemmett/c105d3e0fbea7558088f68c65e68e1ed/">list of the packages that I used</a> as a gist. Using this, I can then simply run this script on any new R install. In fact, if you click the “raw” button on the gist, and copy that url, you can simply run</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">source</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://gist.githubusercontent.com/tomjemmett/c105d3e0fbea7558088f68c65e68e1ed/raw/a1db4b5fa0d24562d16d3f57fe8c25fb0d8aa53e/setup.R"</span>)</span></code></pre></div>
<p>Generally, sourcing a url is a bad idea - the reason for this is if it’s not a link that you control, then someone could update the contents and run arbritary code on your machine. In this case, I’m happy to run this as it’s my own gist, but you should be mindful if running it yourself!</p>
<p>If you look at the script I first install a number of packages from CRAN, then I install packages that only exist on GitHub.</p>



 ]]></description>
  <category>git</category>
  <category>tutorial</category>
  <guid>https://the-strategy-unit.github.io/data_science/blogs/posts/2023-04-26-reinstalling-r-packages.html</guid>
  <pubDate>Wed, 26 Apr 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Alternative remote repositories</title>
  <dc:creator>Tom Jemmett</dc:creator>
  <link>https://the-strategy-unit.github.io/data_science/blogs/posts/2023-04-26_alternative_remotes.html</link>
  <description><![CDATA[ 



<p>It’s great when someone send’s you a pull request on GitHub to fix bugs or add new features to your project, but you probably always want to check the other persons work in someway before merging that pull request.</p>
<p>All of the steps below are intended to be entered via a terminal.</p>
<p>Let’s imagine that we have a GitHub account called example and a repository called test, and we use https rather than ssh.</p>
<pre><code>$ git remote get-url origin
# https://github.com/example/test.git</code></pre>
<p>Now, let’s say we have someone who has submitted a Pull Request (PR), and their username is friend. We can add a new remote for their fork with</p>
<pre><code>$ git remote add friend https://github.com/friend/test.git</code></pre>
<p>Here, I name the remote exactly as per the persons GitHub username for no other reason than making it easier to track things later on. You could name this remote whatever you like, but you will need to make sure that the remote url matches their repository correctly.</p>
<p>We are now able to checkout their remote branch. First, we will want to fetch their work:</p>
<pre><code># make sure to replace the remote name to what you set it to before
$ git fetch friend</code></pre>
<p>Now, hopefully they have commited to a branch with a name that you haven’t used. Let’s say they created a branch called <code>my_work</code>. You can then simply run</p>
<pre><code>$ git switch friend/my_work</code></pre>
<p>This should checkout the <code>my_work</code> branch locally for you.</p>
<p>Now, if they have happened to use a branch name that you are already using, or more likely, directly commited to their own <code>main</code> branch, you will need to do checkout to a new branch:</p>
<pre><code># replace friend as above to be the name of the remote, and main to be the branch
# that they have used
# replace their_work with whatever you want to call this branch locally
$ git checkout friend/main -b their_work</code></pre>
<p>You are now ready to run their code and check everything is good to merge!</p>
<p>Finally, If you want to clean up your local repository you can remove the new branch that you checked out and the new remote with the following steps:</p>
<pre><code># switch back to one of your branches, e.g. main
$ git checkout main

# then remove the branch that you created above
$ git branch -D their_work

# you can remove the remote
$ git remote remove friend</code></pre>



 ]]></description>
  <category>git</category>
  <category>tutorial</category>
  <guid>https://the-strategy-unit.github.io/data_science/blogs/posts/2023-04-26_alternative_remotes.html</guid>
  <pubDate>Wed, 26 Apr 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Creating a hotfix with git</title>
  <dc:creator>Tom Jemmett</dc:creator>
  <link>https://the-strategy-unit.github.io/data_science/blogs/posts/2023-03-24_hotfix-with-git.html</link>
  <description><![CDATA[ 



<p>I recently discovered a bug in a code-base which needed to be fixed and deployed back to production A.S.A.P., but since the last release the code has moved on significantly. The history looks something a bit like:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="https://the-strategy-unit.github.io/data_science/blogs/posts/2023-03-24_hotfix-with-git_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>That is, we have a tag which is the code that is currently in production (which we need to patch), a number of commits after that tag to main (which were separate branches merged via pull requests), and a current development branch.</p>
<p>I need to somehow: 1. go back to the tagged release, 2. check that code out, 3. patch that code, 4. commit this change, but insert the commit before all of the new commits after the tag</p>
<p>There are at least two ways that I know to do this, one would be with an <a href="https://about.gitlab.com/blog/2020/11/23/keep-git-history-clean-with-interactive-rebase/">interactive rebase</a>, but I used a slightly longer method, but one I feel is a little less likely to get wrong.</p>
<p>Below are the step’s that I took. One thing I should note is this worked well for my particular issue because the change didn’t cause any merge conflicts later on.</p>
<section id="fixing-my-codebase" class="level2">
<h2 class="anchored" data-anchor-id="fixing-my-codebase">Fixing my codebase</h2>
<p>First, we need to checkout the tag</p>
<pre><code>git checkout -b hotfix v0.2.0</code></pre>
<p>This creates a new branch called <code>hotfix</code> off of the tag <code>v0.2.0</code>.</p>
<p>Now that I have the code base checked out at the point I need to fix, I can make the change that is needed, and commit the change</p>
<pre><code>git add [FILENAME]
git commit -m "fixes the code"</code></pre>
<p><em>(Obviously, I used the actual file name and gave a better commit message. I Promise 😝)</em></p>
<p>Now my code is fixed, I create a new tag for this “release”, as well as push the code to production (this step is omitted here)</p>
<pre><code>git tag v0.2.1 -m "version 0.2.0"</code></pre>
<p>At this point, our history looks something like</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="https://the-strategy-unit.github.io/data_science/blogs/posts/2023-03-24_hotfix-with-git_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>What we want to do is break the link between main and <code>v0.2.0</code>, instead attaching to<code>v0.2.1</code>. First though, I want to make sure that if I make a mistake, I’m not making it on the main branch.</p>
<pre><code>git checkout main
git checkout -b apply-hotfix</code></pre>
<p>Then we can fix our history using the rebase command</p>
<pre><code>git rebase hotfix</code></pre>
<p>What this does is it rolls back to the point where the branch that we are rebasing (<code>apply-hotfix</code>) and the <code>hotfix</code> branch both share a common commit (<code>v0.2.0</code> tag). It then applies the commits in the <code>hotfix</code> branch, before reapplying the commits from <code>apply-hotfix</code> (a.k.a. the <code>main</code> branch).</p>
<p>One thing to note, if you have any merge conflicts created by your fix, then the rebase will stop and ask you to fix the merge conflicts. There is some information in the GitHub doc’s for [resolving merge conflicts after a Git rebase][2].</p>
<p>[2]: https://docs.github.com/en/get-started/using-git/resolving-merge-conflicts-after-a-git-rebase</p>
<p>At this point, we can check that the commit history looks correct</p>
<pre><code>git log v0.2.0..HEAD</code></pre>
<p>If we are happy, then we can apply this to the <code>main</code> branch. I do this by renaming the <code>apply-hotfix</code> branch as <code>main</code>. First, you have to delete the <code>main</code> branch to allow us to rename the branch.</p>
<pre><code>git branch -D main
git branch -m main</code></pre>
<p>We also need to update the other branches to use the new main branch</p>
<pre><code>git checkout branch
git rebase main</code></pre>
<p>Now, we should have a history like</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="https://the-strategy-unit.github.io/data_science/blogs/posts/2023-03-24_hotfix-with-git_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>

 ]]></description>
  <category>git</category>
  <category>tutorial</category>
  <guid>https://the-strategy-unit.github.io/data_science/blogs/posts/2023-03-24_hotfix-with-git.html</guid>
  <pubDate>Fri, 24 Mar 2023 00:00:00 GMT</pubDate>
</item>
</channel>
</rss>
