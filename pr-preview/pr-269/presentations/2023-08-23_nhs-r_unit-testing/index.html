<!DOCTYPE html>
<html lang="en"><head>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.40">

  <meta name="author" content="Tom Jemmett">
  <title>Data Science @ The Strategy Unit â€“ Unit testing in R</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/theme/quarto-e7966c0233e7045482ebe8837d22f7e9.css">
  <link href="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Unit testing in R</h1>
  <p class="subtitle">NHS-R Community Webinar</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
<a href="tom.jemmett@gmail.com" target="_blank">Tom Jemmett</a> 
</div>
</div>
</div>

  <p class="date">Aug 23, 2023</p>
</section>
<section id="what-is-testing" class="slide level2">
<h2>What is testing?</h2>
<blockquote>
<p>Software testing is the act of examining the artifacts and the behavior of the software under test by validation and verification. Software testing can also provide an objective, independent view of the software to allow the business to appreciate and understand the risks of software implementation</p>
<p><a href="https://en.wikipedia.org/wiki/Software_testing">wikipedia</a></p>
</blockquote>
</section>
<section id="how-can-we-test-our-code" class="slide level2">
<h2>How can we test our code?</h2>
<div class="columns">
<div class="column" style="width:45%;">
<h4 id="statically">Statically</h4>
<div>
<ul>
<li class="fragment">(without executing the code)</li>
<li class="fragment">happens constantly, as we are writing code</li>
<li class="fragment">via code reviews</li>
<li class="fragment">compilers/interpreters/linters statically analyse the code for syntax errors</li>
</ul>
</div>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">
<h4 id="dynamically">Dynamically</h4>
</div></div>
</section>
<section id="how-can-we-test-our-code-1" class="slide level2">
<h2>How can we test our code?</h2>
<div class="columns">
<div class="column very-light-charcoal" style="width:45%;">
<h4 id="statically-1">Statically</h4>
<ul>
<li>(without executing the code)</li>
<li>happens constantly, as we are writing code</li>
<li>via code reviews</li>
<li>compilers/interpreters/linters statically analyse the code for syntax errors</li>
</ul>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">
<h4 id="dynamically-1">Dynamically</h4>
<div>
<ul>
<li class="fragment">(by executing the code)</li>
<li class="fragment">split into functional and non-functional testing</li>
<li class="fragment">testing can be manual, or automated</li>
</ul>
</div>
</div></div>
<aside class="notes">
<ul>
<li>non-functional testing covers things like performance, security, and usability testing</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="different-types-of-functional-tests" class="slide level2">
<h2>Different types of functional tests</h2>
<p><span class="yellow"><strong>Unit Testing</strong></span> checks each component (or unit) for accuracy independently of one another.</p>
<div class="fragment">
<p><span class="yellow"><strong>Integration Testing</strong></span> integrates units to ensure that the code works together.</p>
</div>
<div class="fragment">
<p><span class="yellow"><strong>End-to-End Testing</strong></span> (e2e) makes sure that the entire system functions correctly.</p>
</div>
<div class="fragment">
<p><span class="yellow"><strong>User Acceptance Testing</strong></span> (UAT) ensures that the product meets the real userâ€™s requirements.</p>
</div>
</section>
<section id="different-types-of-functional-tests-1" class="slide level2">
<h2>Different types of functional tests</h2>
<p><span class="yellow"><strong>Unit Testing</strong></span> checks each component (or unit) for accuracy independently of one another.</p>
<p><span class="yellow"><strong>Integration Testing</strong></span> integrates units to ensure that the code works together.</p>
<p><span class="yellow"><strong>End-to-End Testing</strong></span> (e2e) makes sure that the entire system functions correctly.</p>
<div class="very-light-charcoal">
<p><strong>User Acceptance Testing</strong> (UAT) ensures that the product meets the real userâ€™s requirements.</p>
</div>
<aside class="notes">
<p>Unit, Integration, and E2E testing are all things we can automate in code, whereas UAT testing is going to be manual</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="different-types-of-functional-tests-2" class="slide level2">
<h2>Different types of functional tests</h2>
<p><span class="yellow"><strong>Unit Testing</strong></span> checks each component (or unit) for accuracy independently of one another.</p>
<div class="very-light-charcoal">
<p><strong>Integration Testing</strong> integrates units to ensure that the code works together.</p>
<p><strong>End-to-End Testing</strong> (e2e) makes sure that the entire system functions correctly.</p>
<p><strong>User Acceptance Testing</strong> (UAT) ensures that the product meets the real userâ€™s requirements.</p>
</div>
<aside class="notes">
<p>Only focussing on unit testing in this talk, but the techniques/packages could be extended to integration testing. Often other tools (potentially specific tools) are needed for E2E testing.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="example" class="slide level2">
<h2>Example</h2>
<p>We have a <code>{shiny}</code> app which grabs some data from a database, manipulates the data, and generates a plot.</p>
<div>
<ul>
<li class="fragment">we would write <strong>unit tests</strong> to check the data manipulation and plot functions work correctly (with pre-created sample/simple datasets)</li>
<li class="fragment">we would write <strong>integration tests</strong> to check that the data manipulation function works with the plot function (with similar data to what we used for the <strong>unit tests</strong>)</li>
<li class="fragment">we would write <strong>e2e</strong> tests to ensure that from start to finish the app grabs the data and produces a plot as required</li>
</ul>
</div>
<aside class="notes">
<p>simple (unit tests) to complex (e2e tests)</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="testing-pyramid" class="slide level2">
<h2>Testing Pyramid</h2>

<img data-src="https://global-uploads.webflow.com/619e15d781b21202de206fb5/6316d9f844c1d214873c6c9b_the-software-testing-pyramid.webp" class="r-stretch"><div class="footer">
<p><span class="light-charcoal">Image source:</span> The Testing Pyramid: Simplified for One and All <a href="https://www.headspin.io/blog/the-testing-pyramid-simplified-for-one-and-all">headspin.io</a></p>
</div>
</section>
<section>
<section id="unit-testing" class="title-slide slide level1 inverse center">
<h1>Unit <span class="yellow">Testing</span></h1>
<div class="fragment">
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a><span class="fu">install.packages</span>(<span class="st">"testthat"</span>)</span>
<span id="cb1-2"><a></a></span>
<span id="cb1-3"><a></a><span class="fu">library</span>(testthat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lets-create-a-simple-function" class="slide level2">
<h2>Letâ€™s create a simple functionâ€¦</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a>my_function <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb2-2"><a></a>  </span>
<span id="cb2-3"><a></a>  <span class="fu">stopifnot</span>(</span>
<span id="cb2-4"><a></a>    <span class="st">"x must be numeric"</span> <span class="ot">=</span> <span class="fu">is.numeric</span>(x),</span>
<span id="cb2-5"><a></a>    <span class="st">"y must be numeric"</span> <span class="ot">=</span> <span class="fu">is.numeric</span>(y),</span>
<span id="cb2-6"><a></a>    <span class="st">"x must be same length as y"</span> <span class="ot">=</span> <span class="fu">length</span>(x) <span class="sc">==</span> <span class="fu">length</span>(y),</span>
<span id="cb2-7"><a></a>    <span class="st">"cannot divide by zero!"</span> <span class="ot">=</span> y <span class="sc">!=</span> <span class="dv">0</span></span>
<span id="cb2-8"><a></a>  )</span>
<span id="cb2-9"><a></a></span>
<span id="cb2-10"><a></a>  x <span class="sc">/</span> y</span>
<span id="cb2-11"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lets-create-a-simple-function-1" class="slide level2">
<h2>Letâ€™s create a simple functionâ€¦</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" data-code-line-numbers="1,10,11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a>my_function <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb3-2"><a></a>  </span>
<span id="cb3-3"><a></a>  <span class="fu">stopifnot</span>(</span>
<span id="cb3-4"><a></a>    <span class="st">"x must be numeric"</span> <span class="ot">=</span> <span class="fu">is.numeric</span>(x),</span>
<span id="cb3-5"><a></a>    <span class="st">"y must be numeric"</span> <span class="ot">=</span> <span class="fu">is.numeric</span>(y),</span>
<span id="cb3-6"><a></a>    <span class="st">"x must be same length as y"</span> <span class="ot">=</span> <span class="fu">length</span>(x) <span class="sc">==</span> <span class="fu">length</span>(y),</span>
<span id="cb3-7"><a></a>    <span class="st">"cannot divide by zero!"</span> <span class="ot">=</span> y <span class="sc">!=</span> <span class="dv">0</span></span>
<span id="cb3-8"><a></a>  )</span>
<span id="cb3-9"><a></a></span>
<span id="cb3-10"><a></a>  x <span class="sc">/</span> y</span>
<span id="cb3-11"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lets-create-a-simple-function-2" class="slide level2">
<h2>Letâ€™s create a simple functionâ€¦</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" data-code-line-numbers="3-8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a>my_function <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb4-2"><a></a>  </span>
<span id="cb4-3"><a></a>  <span class="fu">stopifnot</span>(</span>
<span id="cb4-4"><a></a>    <span class="st">"x must be numeric"</span> <span class="ot">=</span> <span class="fu">is.numeric</span>(x),</span>
<span id="cb4-5"><a></a>    <span class="st">"y must be numeric"</span> <span class="ot">=</span> <span class="fu">is.numeric</span>(y),</span>
<span id="cb4-6"><a></a>    <span class="st">"x must be same length as y"</span> <span class="ot">=</span> <span class="fu">length</span>(x) <span class="sc">==</span> <span class="fu">length</span>(y),</span>
<span id="cb4-7"><a></a>    <span class="st">"cannot divide by zero!"</span> <span class="ot">=</span> y <span class="sc">!=</span> <span class="dv">0</span></span>
<span id="cb4-8"><a></a>  )</span>
<span id="cb4-9"><a></a></span>
<span id="cb4-10"><a></a>  x <span class="sc">/</span> y</span>
<span id="cb4-11"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer">
<p><a href="https://www.r-bloggers.com/2018/07/the-ten-rules-of-defensive-programming-in-r/">The Ten Rules of Defensive Programming in R</a></p>
</div>
</section>
<section id="and-create-our-first-test" class="slide level2">
<h2>â€¦ and create our first test</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a><span class="fu">test_that</span>(<span class="st">"my_function correctly divides values"</span>, {</span>
<span id="cb5-2"><a></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb5-3"><a></a>    <span class="fu">my_function</span>(<span class="dv">4</span>, <span class="dv">2</span>),</span>
<span id="cb5-4"><a></a>    <span class="dv">2</span></span>
<span id="cb5-5"><a></a>  )</span>
<span id="cb5-6"><a></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb5-7"><a></a>    <span class="fu">my_function</span>(<span class="dv">1</span>, <span class="dv">4</span>),</span>
<span id="cb5-8"><a></a>    <span class="fl">0.25</span></span>
<span id="cb5-9"><a></a>  )</span>
<span id="cb5-10"><a></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb5-11"><a></a>    <span class="fu">my_function</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)),</span>
<span id="cb5-12"><a></a>    <span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">0.25</span>)</span>
<span id="cb5-13"><a></a>  )</span>
<span id="cb5-14"><a></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="and-create-our-first-test-1" class="slide level2">
<h2>â€¦ and create our first test</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" data-code-line-numbers="1,14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a></a><span class="fu">test_that</span>(<span class="st">"my_function correctly divides values"</span>, {</span>
<span id="cb6-2"><a></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb6-3"><a></a>    <span class="fu">my_function</span>(<span class="dv">4</span>, <span class="dv">2</span>),</span>
<span id="cb6-4"><a></a>    <span class="dv">2</span></span>
<span id="cb6-5"><a></a>  )</span>
<span id="cb6-6"><a></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb6-7"><a></a>    <span class="fu">my_function</span>(<span class="dv">1</span>, <span class="dv">4</span>),</span>
<span id="cb6-8"><a></a>    <span class="fl">0.25</span></span>
<span id="cb6-9"><a></a>  )</span>
<span id="cb6-10"><a></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb6-11"><a></a>    <span class="fu">my_function</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)),</span>
<span id="cb6-12"><a></a>    <span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">0.25</span>)</span>
<span id="cb6-13"><a></a>  )</span>
<span id="cb6-14"><a></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="and-create-our-first-test-2" class="slide level2">
<h2>â€¦ and create our first test</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" data-code-line-numbers="3,7,11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a><span class="fu">test_that</span>(<span class="st">"my_function correctly divides values"</span>, {</span>
<span id="cb7-2"><a></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb7-3"><a></a>    <span class="fu">my_function</span>(<span class="dv">4</span>, <span class="dv">2</span>),</span>
<span id="cb7-4"><a></a>    <span class="dv">2</span></span>
<span id="cb7-5"><a></a>  )</span>
<span id="cb7-6"><a></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb7-7"><a></a>    <span class="fu">my_function</span>(<span class="dv">1</span>, <span class="dv">4</span>),</span>
<span id="cb7-8"><a></a>    <span class="fl">0.25</span></span>
<span id="cb7-9"><a></a>  )</span>
<span id="cb7-10"><a></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb7-11"><a></a>    <span class="fu">my_function</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)),</span>
<span id="cb7-12"><a></a>    <span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">0.25</span>)</span>
<span id="cb7-13"><a></a>  )</span>
<span id="cb7-14"><a></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="and-create-our-first-test-3" class="slide level2">
<h2>â€¦ and create our first test</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" data-code-line-numbers="4,8,12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a><span class="fu">test_that</span>(<span class="st">"my_function correctly divides values"</span>, {</span>
<span id="cb8-2"><a></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb8-3"><a></a>    <span class="fu">my_function</span>(<span class="dv">4</span>, <span class="dv">2</span>),</span>
<span id="cb8-4"><a></a>    <span class="dv">2</span></span>
<span id="cb8-5"><a></a>  )</span>
<span id="cb8-6"><a></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb8-7"><a></a>    <span class="fu">my_function</span>(<span class="dv">1</span>, <span class="dv">4</span>),</span>
<span id="cb8-8"><a></a>    <span class="fl">0.25</span></span>
<span id="cb8-9"><a></a>  )</span>
<span id="cb8-10"><a></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb8-11"><a></a>    <span class="fu">my_function</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)),</span>
<span id="cb8-12"><a></a>    <span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">0.25</span>)</span>
<span id="cb8-13"><a></a>  )</span>
<span id="cb8-14"><a></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="and-create-our-first-test-4" class="slide level2">
<h2>â€¦ and create our first test</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" data-code-line-numbers="2,5,6,9,10,13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a><span class="fu">test_that</span>(<span class="st">"my_function correctly divides values"</span>, {</span>
<span id="cb9-2"><a></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb9-3"><a></a>    <span class="fu">my_function</span>(<span class="dv">4</span>, <span class="dv">2</span>),</span>
<span id="cb9-4"><a></a>    <span class="dv">2</span></span>
<span id="cb9-5"><a></a>  )</span>
<span id="cb9-6"><a></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb9-7"><a></a>    <span class="fu">my_function</span>(<span class="dv">1</span>, <span class="dv">4</span>),</span>
<span id="cb9-8"><a></a>    <span class="fl">0.25</span></span>
<span id="cb9-9"><a></a>  )</span>
<span id="cb9-10"><a></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb9-11"><a></a>    <span class="fu">my_function</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)),</span>
<span id="cb9-12"><a></a>    <span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">0.25</span>)</span>
<span id="cb9-13"><a></a>  )</span>
<span id="cb9-14"><a></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="and-create-our-first-test-5" class="slide level2">
<h2>â€¦ and create our first test</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a></a><span class="fu">test_that</span>(<span class="st">"my_function correctly divides values"</span>, {</span>
<span id="cb10-2"><a></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb10-3"><a></a>    <span class="fu">my_function</span>(<span class="dv">4</span>, <span class="dv">2</span>),</span>
<span id="cb10-4"><a></a>    <span class="dv">2</span></span>
<span id="cb10-5"><a></a>  )</span>
<span id="cb10-6"><a></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb10-7"><a></a>    <span class="fu">my_function</span>(<span class="dv">1</span>, <span class="dv">4</span>),</span>
<span id="cb10-8"><a></a>    <span class="fl">0.25</span></span>
<span id="cb10-9"><a></a>  )</span>
<span id="cb10-10"><a></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb10-11"><a></a>    <span class="fu">my_function</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)),</span>
<span id="cb10-12"><a></a>    <span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">0.25</span>)</span>
<span id="cb10-13"><a></a>  )</span>
<span id="cb10-14"><a></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed ðŸ˜¸</code></pre>
</div>
</div>
</section>
<section id="other-expect_-functions" class="slide level2">
<h2>other <code>expect_*()</code> functionsâ€¦</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a></a><span class="fu">test_that</span>(<span class="st">"my_function correctly divides values"</span>, {</span>
<span id="cb12-2"><a></a>  <span class="fu">expect_lt</span>(</span>
<span id="cb12-3"><a></a>    <span class="fu">my_function</span>(<span class="dv">4</span>, <span class="dv">2</span>),</span>
<span id="cb12-4"><a></a>    <span class="dv">10</span></span>
<span id="cb12-5"><a></a>  )</span>
<span id="cb12-6"><a></a>  <span class="fu">expect_gt</span>(</span>
<span id="cb12-7"><a></a>    <span class="fu">my_function</span>(<span class="dv">1</span>, <span class="dv">4</span>),</span>
<span id="cb12-8"><a></a>    <span class="fl">0.2</span></span>
<span id="cb12-9"><a></a>  )</span>
<span id="cb12-10"><a></a>  <span class="fu">expect_length</span>(</span>
<span id="cb12-11"><a></a>    <span class="fu">my_function</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)),</span>
<span id="cb12-12"><a></a>    <span class="dv">2</span></span>
<span id="cb12-13"><a></a>  )</span>
<span id="cb12-14"><a></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed ðŸ˜¸</code></pre>
</div>
</div>
<div class="footer">
<p><a href="https://testthat.r-lib.org/reference/index.html">{testthat} documentation</a></p>
</div>
</section>
<section id="arrange-act-assert" class="slide level2">
<h2>Arrange, Act, Assert</h2>
<div class="columns">
<div class="column" style="width:50%;">

</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a></a><span class="fu">test_that</span>(<span class="st">"my_function works"</span>, {</span>
<span id="cb14-2"><a></a>  <span class="co"># arrange</span></span>
<span id="cb14-3"><a></a>  <span class="co">#  </span></span>
<span id="cb14-4"><a></a>  <span class="co">#</span></span>
<span id="cb14-5"><a></a>  <span class="co">#</span></span>
<span id="cb14-6"><a></a></span>
<span id="cb14-7"><a></a>  <span class="co"># act</span></span>
<span id="cb14-8"><a></a>  <span class="co">#</span></span>
<span id="cb14-9"><a></a></span>
<span id="cb14-10"><a></a>  <span class="co"># assert</span></span>
<span id="cb14-11"><a></a>  <span class="co">#</span></span>
<span id="cb14-12"><a></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>
</section>
<section id="arrange-act-assert-1" class="slide level2">
<h2>Arrange, Act, Assert</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>we <span class="yellow"><strong>arrange</strong></span> the environment, before running the function</p>
<div>
<ul>
<li class="fragment">to create sample values</li>
<li class="fragment">create fake/temporary files</li>
<li class="fragment">set random seed</li>
<li class="fragment">set R options/environment variables</li>
</ul>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb15" data-code-line-numbers="2-5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a></a><span class="fu">test_that</span>(<span class="st">"my_function works"</span>, {</span>
<span id="cb15-2"><a></a>  <span class="co"># arrange</span></span>
<span id="cb15-3"><a></a>  x <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb15-4"><a></a>  y <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb15-5"><a></a>  expected <span class="ot">&lt;-</span> <span class="fl">0.714285</span></span>
<span id="cb15-6"><a></a></span>
<span id="cb15-7"><a></a>  <span class="co"># act</span></span>
<span id="cb15-8"><a></a>  <span class="co">#</span></span>
<span id="cb15-9"><a></a></span>
<span id="cb15-10"><a></a>  <span class="co"># assert</span></span>
<span id="cb15-11"><a></a>  <span class="co">#</span></span>
<span id="cb15-12"><a></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>
</section>
<section id="arrange-act-assert-2" class="slide level2">
<h2>Arrange, Act, Assert</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><span class="very-light-charcoal">we <strong>arrange</strong> the environment, before running the function</span></p>
<p>we <span class="yellow"><strong>act</strong></span> by calling the function</p>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb16" data-code-line-numbers="7-8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a></a><span class="fu">test_that</span>(<span class="st">"my_function works"</span>, {</span>
<span id="cb16-2"><a></a>  <span class="co"># arrange</span></span>
<span id="cb16-3"><a></a>  x <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb16-4"><a></a>  y <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb16-5"><a></a>  expected <span class="ot">&lt;-</span> <span class="fl">0.714285</span></span>
<span id="cb16-6"><a></a></span>
<span id="cb16-7"><a></a>  <span class="co"># act</span></span>
<span id="cb16-8"><a></a>  actual <span class="ot">&lt;-</span> <span class="fu">my_function</span>(x, y)</span>
<span id="cb16-9"><a></a></span>
<span id="cb16-10"><a></a>  <span class="co"># assert</span></span>
<span id="cb16-11"><a></a>  <span class="co">#</span></span>
<span id="cb16-12"><a></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>
</section>
<section id="arrange-act-assert-3" class="slide level2">
<h2>Arrange, Act, Assert</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><span class="very-light-charcoal">we <strong>arrange</strong> the environment, before running the function</span></p>
<p><span class="very-light-charcoal">we <strong>act</strong> by calling the function</span></p>
<p>we <span class="yellow"><strong>assert</strong></span> that the <strong>actual</strong> results match our <strong>expected</strong> results</p>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb17" data-code-line-numbers="10-11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a><span class="fu">test_that</span>(<span class="st">"my_function works"</span>, {</span>
<span id="cb17-2"><a></a>  <span class="co"># arrange</span></span>
<span id="cb17-3"><a></a>  x <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb17-4"><a></a>  y <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb17-5"><a></a>  expected <span class="ot">&lt;-</span> <span class="fl">0.714285</span></span>
<span id="cb17-6"><a></a></span>
<span id="cb17-7"><a></a>  <span class="co"># act</span></span>
<span id="cb17-8"><a></a>  actual <span class="ot">&lt;-</span> <span class="fu">my_function</span>(x, y)</span>
<span id="cb17-9"><a></a></span>
<span id="cb17-10"><a></a>  <span class="co"># assert</span></span>
<span id="cb17-11"><a></a>  <span class="fu">expect_equal</span>(actual, expected)</span>
<span id="cb17-12"><a></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>
</section>
<section id="our-test-failed" class="slide level2">
<h2>Our test failed!?! ðŸ˜¢</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a></a><span class="fu">test_that</span>(<span class="st">"my_function works"</span>, {</span>
<span id="cb18-2"><a></a>  <span class="co"># arrange</span></span>
<span id="cb18-3"><a></a>  x <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb18-4"><a></a>  y <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb18-5"><a></a>  expected <span class="ot">&lt;-</span> <span class="fl">0.714285</span></span>
<span id="cb18-6"><a></a></span>
<span id="cb18-7"><a></a>  <span class="co"># act</span></span>
<span id="cb18-8"><a></a>  actual <span class="ot">&lt;-</span> <span class="fu">my_function</span>(x, y)</span>
<span id="cb18-9"><a></a></span>
<span id="cb18-10"><a></a>  <span class="co"># assert</span></span>
<span id="cb18-11"><a></a>  <span class="fu">expect_equal</span>(actual, expected)</span>
<span id="cb18-12"><a></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>â”€â”€ Failure: my_function works â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
`actual` not equal to `expected`.
1/1 mismatches
[1] 0.714 - 0.714 == 7.14e-07</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error:
! Test failed</code></pre>
</div>
</div>
</section>
<section id="tolerance-to-the-rescue" class="slide level2">
<h2>Tolerance to the rescue ðŸ™‚</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a></a><span class="fu">test_that</span>(<span class="st">"my_function works"</span>, {</span>
<span id="cb21-2"><a></a>  <span class="co"># arrange</span></span>
<span id="cb21-3"><a></a>  x <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb21-4"><a></a>  y <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb21-5"><a></a>  expected <span class="ot">&lt;-</span> <span class="fl">0.714285</span></span>
<span id="cb21-6"><a></a></span>
<span id="cb21-7"><a></a>  <span class="co"># act</span></span>
<span id="cb21-8"><a></a>  actual <span class="ot">&lt;-</span> <span class="fu">my_function</span>(x, y)</span>
<span id="cb21-9"><a></a></span>
<span id="cb21-10"><a></a>  <span class="co"># assert</span></span>
<span id="cb21-11"><a></a>  <span class="fu">expect_equal</span>(actual, expected, <span class="at">tolerance =</span> <span class="fl">1e-6</span>)</span>
<span id="cb21-12"><a></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed ðŸŽ‰</code></pre>
</div>
</div>
<div class="fragment">
<p><span class="small">(<em>this is a slightly artificial example, usually the default tolerance is good enough</em>)</span></p>
</div>
</section>
<section id="testing-edge-cases" class="slide level2">
<h2>Testing edge cases</h2>
<div class="columns">
<div class="column" style="width:40%;">
<p>Remember the validation steps we built into our function to handle edge cases?</p>
<p><br></p>
<p>Letâ€™s write tests for these edge cases:</p>
<p><span class="yellow">we expect errors</span></p>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a></a><span class="fu">test_that</span>(<span class="st">"my_function works"</span>, {</span>
<span id="cb23-2"><a></a>  <span class="fu">expect_error</span>(<span class="fu">my_function</span>(<span class="dv">5</span>, <span class="dv">0</span>))</span>
<span id="cb23-3"><a></a>  <span class="fu">expect_error</span>(<span class="fu">my_function</span>(<span class="st">"a"</span>, <span class="dv">3</span>))</span>
<span id="cb23-4"><a></a>  <span class="fu">expect_error</span>(<span class="fu">my_function</span>(<span class="dv">3</span>, <span class="st">"a"</span>))</span>
<span id="cb23-5"><a></a>  <span class="fu">expect_error</span>(<span class="fu">my_function</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">4</span>))</span>
<span id="cb23-6"><a></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed ðŸ˜€</code></pre>
</div>
</div>
</div></div>
</section>
<section id="another-simple-example" class="slide level2">
<h2>Another (simple) example</h2>
<div class="columns">
<div class="column" style="width:60%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a></a>my_new_function <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb25-2"><a></a>  <span class="cf">if</span> (x <span class="sc">&gt;</span> y) {</span>
<span id="cb25-3"><a></a>    <span class="st">"x"</span></span>
<span id="cb25-4"><a></a>  } <span class="cf">else</span> {</span>
<span id="cb25-5"><a></a>    <span class="st">"y"</span></span>
<span id="cb25-6"><a></a>  }</span>
<span id="cb25-7"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:40%;">
<p>Consider this function - there is <span class="yellow">branched logic</span>, so we need to carefully design tests to validate the logic works as intended.</p>
</div></div>
</section>
<section id="another-simple-example-1" class="slide level2">
<h2>Another (simple) example</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a></a>my_new_function <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb26-2"><a></a>  <span class="cf">if</span> (x <span class="sc">&gt;</span> y) {</span>
<span id="cb26-3"><a></a>    <span class="st">"x"</span></span>
<span id="cb26-4"><a></a>  } <span class="cf">else</span> {</span>
<span id="cb26-5"><a></a>    <span class="st">"y"</span></span>
<span id="cb26-6"><a></a>  }</span>
<span id="cb26-7"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a></a><span class="fu">test_that</span>(<span class="st">"it returns 'x' if x is bigger than y"</span>, {</span>
<span id="cb27-2"><a></a>  <span class="fu">expect_equal</span>(<span class="fu">my_new_function</span>(<span class="dv">4</span>, <span class="dv">3</span>), <span class="st">"x"</span>)</span>
<span id="cb27-3"><a></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed ðŸ˜€</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a></a><span class="fu">test_that</span>(<span class="st">"it returns 'y' if y is bigger than x"</span>, {</span>
<span id="cb29-2"><a></a>  <span class="fu">expect_equal</span>(<span class="fu">my_new_function</span>(<span class="dv">3</span>, <span class="dv">4</span>), <span class="st">"y"</span>)</span>
<span id="cb29-3"><a></a>  <span class="fu">expect_equal</span>(<span class="fu">my_new_function</span>(<span class="dv">3</span>, <span class="dv">3</span>), <span class="st">"y"</span>)</span>
<span id="cb29-4"><a></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed ðŸ¥‡</code></pre>
</div>
</div>
</section>
<section id="how-to-design-good-tests" class="slide level2">
<h2>How to design good tests</h2>
<p><span class="small"><em>a non-exhaustive list</em></span></p>
<ul>
<li>consider all the functions arguments,</li>
<li>what are the <span class="yellow">expected</span> values for these arguments?</li>
<li>what are <span class="yellow">unexpected</span> values, and are they handled?</li>
<li>are there <span class="yellow">edge cases</span> that need to be handled?</li>
<li>have you covered all of the <span class="yellow">different paths</span> in your code?</li>
<li>have you managed to create tests that check the <span class="yellow">range of results</span> you expect?</li>
</ul>
</section>
<section id="but-why-create-tests" class="slide level2">
<h2>But, why create tests?</h2>
<p><span class="small"><em>another non-exhaustive list</em></span></p>
<ul>
<li>good tests will help you uncover existing issues in your code</li>
<li>will defend you from future changes that break existing functionality</li>
<li>will alert you to changes in dependencies that may have changed the functionality of your code</li>
<li>can act as documentation for other developers</li>
</ul>
</section>
<section id="testing-complex-functions" class="slide level2">
<h2>Testing complex functions</h2>
<div class="columns">
<div class="column" style="width:70%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a></a>my_big_function <span class="ot">&lt;-</span> <span class="cf">function</span>(type) {</span>
<span id="cb31-2"><a></a>  con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>(), <span class="st">"data.db"</span>)</span>
<span id="cb31-3"><a></a>  df <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">"data_table"</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-4"><a></a>    <span class="fu">collect</span>() <span class="sc">|&gt;</span></span>
<span id="cb31-5"><a></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(date, lubridate<span class="sc">::</span>ymd))</span>
<span id="cb31-6"><a></a></span>
<span id="cb31-7"><a></a>  conditions <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb31-8"><a></a>    <span class="st">"conditions.csv"</span>, <span class="at">col_types =</span> <span class="st">"cc"</span></span>
<span id="cb31-9"><a></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb31-10"><a></a>    <span class="fu">filter</span>(condition_type <span class="sc">==</span> type)</span>
<span id="cb31-11"><a></a></span>
<span id="cb31-12"><a></a>  df <span class="sc">|&gt;</span></span>
<span id="cb31-13"><a></a>    <span class="fu">semi_join</span>(conditions, <span class="at">by =</span> <span class="st">"condition"</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-14"><a></a>    <span class="fu">count</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb31-15"><a></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(date, n)) <span class="sc">+</span></span>
<span id="cb31-16"><a></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb31-17"><a></a>    <span class="fu">geom_point</span>()</span>
<span id="cb31-18"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:30%;">
<p>Where do you even begin to start writing tests for something so complex?</p>
<p><br></p>
<div class="small">
<p><em>Note: to get the code on the left to fit on one page, I skipped including a few library calls</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb32-2"><a></a><span class="fu">library</span>(DBI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div></div>
</section>
<section id="split-the-logic-into-smaller-functions" class="slide level2">
<h2>Split the logic into smaller functions</h2>
<p>Function to get the data from the database</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a></a>get_data_from_sql <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb33-2"><a></a>  con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>(), <span class="st">"data.db"</span>)</span>
<span id="cb33-3"><a></a>  <span class="fu">tbl</span>(con, <span class="st">"data_table"</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-4"><a></a>    <span class="fu">collect</span>() <span class="sc">|&gt;</span></span>
<span id="cb33-5"><a></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(date, lubridate<span class="sc">::</span>ymd))</span>
<span id="cb33-6"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="split-the-logic-into-smaller-functions-1" class="slide level2">
<h2>Split the logic into smaller functions</h2>
<p>Function to get the relevant conditions</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a></a>get_conditions <span class="ot">&lt;-</span> <span class="cf">function</span>(type) {</span>
<span id="cb34-2"><a></a>  <span class="fu">read_csv</span>(</span>
<span id="cb34-3"><a></a>    <span class="st">"conditions.csv"</span>, <span class="at">col_types =</span> <span class="st">"cc"</span></span>
<span id="cb34-4"><a></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb34-5"><a></a>    <span class="fu">filter</span>(condition_type <span class="sc">==</span> type)</span>
<span id="cb34-6"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="split-the-logic-into-smaller-functions-2" class="slide level2">
<h2>Split the logic into smaller functions</h2>
<p>Function to combine the data and create a count by date</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a></a>summarise_data <span class="ot">&lt;-</span> <span class="cf">function</span>(df, conditions) {</span>
<span id="cb35-2"><a></a>  df <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a></a>    <span class="fu">semi_join</span>(conditions, <span class="at">by =</span> <span class="st">"condition"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-4"><a></a>    <span class="fu">count</span>(date)</span>
<span id="cb35-5"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="split-the-logic-into-smaller-functions-3" class="slide level2">
<h2>Split the logic into smaller functions</h2>
<p>Function to generate a plot from the summarised data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a></a>create_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb36-2"><a></a>  df <span class="sc">|&gt;</span></span>
<span id="cb36-3"><a></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(date, n)) <span class="sc">+</span></span>
<span id="cb36-4"><a></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb36-5"><a></a>    <span class="fu">geom_point</span>()</span>
<span id="cb36-6"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="split-the-logic-into-smaller-functions-4" class="slide level2">
<h2>Split the logic into smaller functions</h2>
<p>The original function refactored to use the new functions</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a></a>my_big_function <span class="ot">&lt;-</span> <span class="cf">function</span>(type) {</span>
<span id="cb37-2"><a></a>  conditions <span class="ot">&lt;-</span> <span class="fu">get_conditions</span>(type)</span>
<span id="cb37-3"><a></a></span>
<span id="cb37-4"><a></a>  <span class="fu">get_data_from_sql</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-5"><a></a>    <span class="fu">summarise_data</span>(conditions) <span class="sc">|&gt;</span></span>
<span id="cb37-6"><a></a>    <span class="fu">create_plot</span>()</span>
<span id="cb37-7"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>This is going to be significantly easier to test, because we now can verify that the individual components work correctly, rather than having to consider all of the possibilities at once.</p>
</div>
</section>
<section id="lets-test-summarise_data" class="slide level2">
<h2>Letâ€™s test <code>summarise_data</code></h2>
<div class="sourceCode" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a></a>summarise_data <span class="ot">&lt;-</span> <span class="cf">function</span>(df, conditions) {</span>
<span id="cb38-2"><a></a>  df <span class="sc">|&gt;</span></span>
<span id="cb38-3"><a></a>    <span class="fu">semi_join</span>(conditions, <span class="at">by =</span> <span class="st">"condition"</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-4"><a></a>    <span class="fu">count</span>(date)</span>
<span id="cb38-5"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="lets-test-summarise_data-1" class="slide level2">
<h2>Letâ€™s test <code>summarise_data</code></h2>
<div class="sourceCode" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a></a><span class="fu">test_that</span>(<span class="st">"it summarises the data"</span>, {</span>
<span id="cb39-2"><a></a>  <span class="co"># arrange</span></span>
<span id="cb39-3"><a></a>  </span>
<span id="cb39-4"><a></a></span>
<span id="cb39-5"><a></a></span>
<span id="cb39-6"><a></a></span>
<span id="cb39-7"><a></a></span>
<span id="cb39-8"><a></a></span>
<span id="cb39-9"><a></a></span>
<span id="cb39-10"><a></a>  </span>
<span id="cb39-11"><a></a></span>
<span id="cb39-12"><a></a>  </span>
<span id="cb39-13"><a></a>  <span class="co"># act</span></span>
<span id="cb39-14"><a></a>  </span>
<span id="cb39-15"><a></a>  <span class="co"># assert</span></span>
<span id="cb39-16"><a></a>  </span>
<span id="cb39-17"><a></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="lets-test-summarise_data-2" class="slide level2">
<h2>Letâ€™s test <code>summarise_data</code></h2>
<div class="columns">
<div class="column" style="width:75%;">
<div class="sourceCode" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a></a><span class="fu">test_that</span>(<span class="st">"it summarises the data"</span>, {</span>
<span id="cb40-2"><a></a>  <span class="co"># arrange</span></span>
<span id="cb40-3"><a></a>  </span>
<span id="cb40-4"><a></a>  df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb40-5"><a></a>    <span class="at">date =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">300</span>, <span class="cn">TRUE</span>),</span>
<span id="cb40-6"><a></a>    <span class="at">condition =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>), <span class="dv">300</span>, <span class="cn">TRUE</span>)</span>
<span id="cb40-7"><a></a>  )</span>
<span id="cb40-8"><a></a>  </span>
<span id="cb40-9"><a></a></span>
<span id="cb40-10"><a></a></span>
<span id="cb40-11"><a></a></span>
<span id="cb40-12"><a></a></span>
<span id="cb40-13"><a></a>  <span class="co"># act</span></span>
<span id="cb40-14"><a></a>  </span>
<span id="cb40-15"><a></a>  <span class="co"># assert</span></span>
<span id="cb40-16"><a></a>  </span>
<span id="cb40-17"><a></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column small" style="width:25%;">
<p>Generate some random data to build a reasonably sized data frame.</p>
<p>You could also create a table manually, but part of the trick of writing good tests for this function is to make it so the dates donâ€™t all have the same count.</p>
<p>The reason for this is itâ€™s harder to know for sure that the count worked if every row returns the same value.</p>
<p>We donâ€™t need the values to be exactly like they are in the real data, just close enough. Instead of dates, we can use numbers, and instead of actual conditions, we can use letters.</p>
</div></div>
</section>
<section id="lets-test-summarise_data-3" class="slide level2">
<h2>Letâ€™s test <code>summarise_data</code></h2>
<div class="columns">
<div class="column" style="width:75%;">
<div class="sourceCode" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a></a><span class="fu">test_that</span>(<span class="st">"it summarises the data"</span>, {</span>
<span id="cb41-2"><a></a>  <span class="co"># arrange</span></span>
<span id="cb41-3"><a></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb41-4"><a></a>  df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb41-5"><a></a>    <span class="at">date =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">300</span>, <span class="cn">TRUE</span>),</span>
<span id="cb41-6"><a></a>    <span class="at">condition =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>), <span class="dv">300</span>, <span class="cn">TRUE</span>)</span>
<span id="cb41-7"><a></a>  )</span>
<span id="cb41-8"><a></a>  </span>
<span id="cb41-9"><a></a></span>
<span id="cb41-10"><a></a></span>
<span id="cb41-11"><a></a></span>
<span id="cb41-12"><a></a></span>
<span id="cb41-13"><a></a>  <span class="co"># act</span></span>
<span id="cb41-14"><a></a>  </span>
<span id="cb41-15"><a></a>  <span class="co"># assert</span></span>
<span id="cb41-16"><a></a>  </span>
<span id="cb41-17"><a></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column small" style="width:25%;">
<p>Tests need to be reproducible, and generating our table at random will give us unpredictable results.</p>
<p>So, we need to set the random seed; now every time this test runs we will generate the same data.</p>
</div></div>
</section>
<section id="lets-test-summarise_data-4" class="slide level2">
<h2>Letâ€™s test <code>summarise_data</code></h2>
<div class="columns">
<div class="column" style="width:75%;">
<div class="sourceCode" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a></a><span class="fu">test_that</span>(<span class="st">"it summarises the data"</span>, {</span>
<span id="cb42-2"><a></a>  <span class="co"># arrange</span></span>
<span id="cb42-3"><a></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb42-4"><a></a>  df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb42-5"><a></a>    <span class="at">date =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">300</span>, <span class="cn">TRUE</span>),</span>
<span id="cb42-6"><a></a>    <span class="at">condition =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>), <span class="dv">300</span>, <span class="cn">TRUE</span>)</span>
<span id="cb42-7"><a></a>  )</span>
<span id="cb42-8"><a></a>  conditions <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">condition =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>))    </span>
<span id="cb42-9"><a></a>  </span>
<span id="cb42-10"><a></a></span>
<span id="cb42-11"><a></a></span>
<span id="cb42-12"><a></a></span>
<span id="cb42-13"><a></a>  <span class="co"># act</span></span>
<span id="cb42-14"><a></a>  </span>
<span id="cb42-15"><a></a>  <span class="co"># assert</span></span>
<span id="cb42-16"><a></a>  </span>
<span id="cb42-17"><a></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column small" style="width:25%;">
<p>Create the conditions table. We donâ€™t need all of the columns that are present in the real csv, just the ones that will make our code work.</p>
<p>We also need to test that the filtering join (<code>semi_join</code>) is working, so we want to use a subset of the conditions that were used in <code>df</code>.</p>
</div></div>
</section>
<section id="lets-test-summarise_data-5" class="slide level2">
<h2>Letâ€™s test <code>summarise_data</code></h2>
<div class="columns">
<div class="column" style="width:75%;">
<div class="sourceCode" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a></a><span class="fu">test_that</span>(<span class="st">"it summarises the data"</span>, {</span>
<span id="cb43-2"><a></a>  <span class="co"># arrange</span></span>
<span id="cb43-3"><a></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb43-4"><a></a>  df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb43-5"><a></a>    <span class="at">date =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">300</span>, <span class="cn">TRUE</span>),</span>
<span id="cb43-6"><a></a>    <span class="at">condition =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>), <span class="dv">300</span>, <span class="cn">TRUE</span>)</span>
<span id="cb43-7"><a></a>  )</span>
<span id="cb43-8"><a></a>  conditions <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">condition =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>))    </span>
<span id="cb43-9"><a></a>  </span>
<span id="cb43-10"><a></a>  </span>
<span id="cb43-11"><a></a></span>
<span id="cb43-12"><a></a>  </span>
<span id="cb43-13"><a></a>  <span class="co"># act</span></span>
<span id="cb43-14"><a></a>  actual <span class="ot">&lt;-</span> <span class="fu">summarise_data</span>(df, conditions)</span>
<span id="cb43-15"><a></a>  <span class="co"># assert</span></span>
<span id="cb43-16"><a></a>  </span>
<span id="cb43-17"><a></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column small" style="width:25%;">
<p>Because we are generating <code>df</code> randomly, to figure out what our â€œexpectedâ€ results are, I simply ran the code inside of the test to generate the â€œactualâ€ results.</p>
<p>Generally, this isnâ€™t a good idea. You are creating the results of your test from the code; ideally, you want to be thinking about what the results of your function should be.</p>
<p>Imagine your function doesnâ€™t work as intended, there is some subtle bug that you are not yet aware of. By writing tests â€œbackwardsâ€ you may write test cases that confirm the results, but not expose the bug. This is why itâ€™s good to think about edge cases.</p>
</div></div>
</section>
<section id="lets-test-summarise_data-6" class="slide level2">
<h2>Letâ€™s test <code>summarise_data</code></h2>
<div class="columns">
<div class="column" style="width:75%;">
<div class="sourceCode" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a></a><span class="fu">test_that</span>(<span class="st">"it summarises the data"</span>, {</span>
<span id="cb44-2"><a></a>  <span class="co"># arrange</span></span>
<span id="cb44-3"><a></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb44-4"><a></a>  df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb44-5"><a></a>    <span class="at">date =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">300</span>, <span class="cn">TRUE</span>),</span>
<span id="cb44-6"><a></a>    <span class="at">condition =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>), <span class="dv">300</span>, <span class="cn">TRUE</span>)</span>
<span id="cb44-7"><a></a>  )</span>
<span id="cb44-8"><a></a>  conditions <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">condition =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>))    </span>
<span id="cb44-9"><a></a>  expected <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb44-10"><a></a>    <span class="at">date =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb44-11"><a></a>    <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">18</span>, <span class="dv">12</span>, <span class="dv">14</span>, <span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">24</span>, <span class="dv">18</span>, <span class="dv">31</span>, <span class="dv">21</span>)</span>
<span id="cb44-12"><a></a>  )  </span>
<span id="cb44-13"><a></a>  <span class="co"># act</span></span>
<span id="cb44-14"><a></a>  actual <span class="ot">&lt;-</span> <span class="fu">summarise_data</span>(df, conditions)</span>
<span id="cb44-15"><a></a>  <span class="co"># assert</span></span>
<span id="cb44-16"><a></a>  </span>
<span id="cb44-17"><a></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column small" style="width:25%;">
<p>That said, in cases where we can be confident (say by static analysis of our code) that it is correct, building tests in this way will give us the confidence going forwards that future changes do not break existing functionality.</p>
<p>In this case, I have created the expected data frame using the results from running the function.</p>
</div></div>
</section>
<section id="lets-test-summarise_data-7" class="slide level2">
<h2>Letâ€™s test <code>summarise_data</code></h2>
<div class="columns">
<div class="column" style="width:75%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a></a><span class="fu">test_that</span>(<span class="st">"it summarises the data"</span>, {</span>
<span id="cb45-2"><a></a>  <span class="co"># arrange</span></span>
<span id="cb45-3"><a></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb45-4"><a></a>  df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb45-5"><a></a>    <span class="at">date =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">300</span>, <span class="cn">TRUE</span>),</span>
<span id="cb45-6"><a></a>    <span class="at">condition =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>), <span class="dv">300</span>, <span class="cn">TRUE</span>)</span>
<span id="cb45-7"><a></a>  )</span>
<span id="cb45-8"><a></a>  conditions <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">condition =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>))</span>
<span id="cb45-9"><a></a>  expected <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb45-10"><a></a>    <span class="at">date =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb45-11"><a></a>    <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">18</span>, <span class="dv">12</span>, <span class="dv">14</span>, <span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">24</span>, <span class="dv">18</span>, <span class="dv">31</span>, <span class="dv">21</span>)</span>
<span id="cb45-12"><a></a>  )</span>
<span id="cb45-13"><a></a>  <span class="co"># act</span></span>
<span id="cb45-14"><a></a>  actual <span class="ot">&lt;-</span> <span class="fu">summarise_data</span>(df, conditions)</span>
<span id="cb45-15"><a></a>  <span class="co"># assert</span></span>
<span id="cb45-16"><a></a>  <span class="fu">expect_equal</span>(actual, expected)</span>
<span id="cb45-17"><a></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed ðŸ˜¸</code></pre>
</div>
</div>
</div><div class="column small" style="width:25%;">
<p>The test works!</p>
</div></div>
</section>
<section id="next-steps" class="slide level2">
<h2>Next steps</h2>
<ul>
<li>You can add tests to any R project (to test functions),</li>
<li>But <code>{testthat}</code> works best with Packages</li>
<li>The R Packages book has 3 chapters on <a href="https://r-pkgs.org/testing-basics.html">testing</a></li>
<li>There are two useful helper functions in <code>{usethis}</code>
<ul>
<li><code>use_testthat()</code> will set up the folders for test scripts</li>
<li><code>use_test()</code> will create a test file for the currently open script</li>
</ul></li>
</ul>
</section>
<section id="next-steps-1" class="slide level2">
<h2>Next steps</h2>
<ul>
<li>If your test needs to temporarily create a file, or change some R-options, the <a href="https://withr.r-lib.org/"><code>{withr}</code> package</a> has a lot of useful functions that will automatically clean things up when the test finishes</li>
<li>If you are writing tests that involve calling out to a database, or you want to test <code>my_big_function</code> (from before) without calling the intermediate functions, then you should look at the <a href="https://github.com/r-lib/mockery"><code>{mockery}</code> package</a></li>
</ul>
</section></section>
<section id="thanks" class="title-slide slide level1 inverse center">
<h1>Thanks!</h1>
<p>Questions?</p>
<p><a href="mailto:thomas.jemmett@nhs.net" target="_blank">thomas.jemmett@nhs.net</a> / DM me on slack</p>


</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p>view slides at <a href="https://the-strategy-unit.github.io/data_science/presentations/2023-08-23_nhs-r_unit-testing">the-strategy-unit.github.io/data_science/presentations</a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': true,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":false},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp("https:\/\/the-strategy-unit\.github\.io\/data_science");
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>